<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue源码分析(十三) 编译之optimize | 码农沉思录</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/favicon.jpg">
    <meta name="description" content="代码千万行, 注释第一行, 编码不规范, 同事两行泪">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.92019516.css" as="style"><link rel="preload" href="/assets/js/app.ad2c5d61.js" as="script"><link rel="preload" href="/assets/js/4.82f582a9.js" as="script"><link rel="preload" href="/assets/js/1.72e48573.js" as="script"><link rel="preload" href="/assets/js/54.5a34c05b.js" as="script"><link rel="prefetch" href="/assets/js/10.6bbbb4af.js"><link rel="prefetch" href="/assets/js/11.84886e2e.js"><link rel="prefetch" href="/assets/js/12.6ab8637d.js"><link rel="prefetch" href="/assets/js/13.ea9ef3eb.js"><link rel="prefetch" href="/assets/js/14.865dcee3.js"><link rel="prefetch" href="/assets/js/15.49d2e55e.js"><link rel="prefetch" href="/assets/js/16.0b37b058.js"><link rel="prefetch" href="/assets/js/17.e5cd5fdd.js"><link rel="prefetch" href="/assets/js/18.85dd604a.js"><link rel="prefetch" href="/assets/js/19.f588c03c.js"><link rel="prefetch" href="/assets/js/20.33d127dd.js"><link rel="prefetch" href="/assets/js/21.2726927d.js"><link rel="prefetch" href="/assets/js/22.95f3f4a3.js"><link rel="prefetch" href="/assets/js/23.d8a538a6.js"><link rel="prefetch" href="/assets/js/24.17ad2529.js"><link rel="prefetch" href="/assets/js/25.f51b2675.js"><link rel="prefetch" href="/assets/js/26.934ec669.js"><link rel="prefetch" href="/assets/js/27.72508c77.js"><link rel="prefetch" href="/assets/js/28.2b0959c4.js"><link rel="prefetch" href="/assets/js/29.1c963303.js"><link rel="prefetch" href="/assets/js/30.8e399044.js"><link rel="prefetch" href="/assets/js/31.e4928ff3.js"><link rel="prefetch" href="/assets/js/32.c6b6ef8d.js"><link rel="prefetch" href="/assets/js/33.ddfa1e4c.js"><link rel="prefetch" href="/assets/js/34.3e4256dd.js"><link rel="prefetch" href="/assets/js/35.8a92b27b.js"><link rel="prefetch" href="/assets/js/36.4167114e.js"><link rel="prefetch" href="/assets/js/37.11de70c3.js"><link rel="prefetch" href="/assets/js/38.51bfcef9.js"><link rel="prefetch" href="/assets/js/39.391d16d4.js"><link rel="prefetch" href="/assets/js/40.75c9b958.js"><link rel="prefetch" href="/assets/js/41.adff1d44.js"><link rel="prefetch" href="/assets/js/42.b18f2f3c.js"><link rel="prefetch" href="/assets/js/43.39857e56.js"><link rel="prefetch" href="/assets/js/44.8d646eb3.js"><link rel="prefetch" href="/assets/js/45.8696e081.js"><link rel="prefetch" href="/assets/js/46.6b1aef3a.js"><link rel="prefetch" href="/assets/js/47.6c8a36c8.js"><link rel="prefetch" href="/assets/js/48.c54441d1.js"><link rel="prefetch" href="/assets/js/49.902cc547.js"><link rel="prefetch" href="/assets/js/5.ebb7f635.js"><link rel="prefetch" href="/assets/js/50.b6dd2518.js"><link rel="prefetch" href="/assets/js/51.ebec3ecf.js"><link rel="prefetch" href="/assets/js/52.5a757ff9.js"><link rel="prefetch" href="/assets/js/53.381b38f6.js"><link rel="prefetch" href="/assets/js/55.a7716bd5.js"><link rel="prefetch" href="/assets/js/56.30b8e2e3.js"><link rel="prefetch" href="/assets/js/57.079ff0b7.js"><link rel="prefetch" href="/assets/js/58.23b4a501.js"><link rel="prefetch" href="/assets/js/59.f41538da.js"><link rel="prefetch" href="/assets/js/6.d3a9d217.js"><link rel="prefetch" href="/assets/js/60.8801415c.js"><link rel="prefetch" href="/assets/js/61.296117b6.js"><link rel="prefetch" href="/assets/js/62.0380b2ff.js"><link rel="prefetch" href="/assets/js/63.4e82cbaa.js"><link rel="prefetch" href="/assets/js/7.6156d368.js"><link rel="prefetch" href="/assets/js/8.1c82c0e7.js"><link rel="prefetch" href="/assets/js/9.3648f843.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.83298789.js">
    <link rel="stylesheet" href="/assets/css/0.styles.92019516.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>码农沉思录</h3> <p class="description" data-v-59e6cb88>代码千万行, 注释第一行, 编码不规范, 同事两行泪</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Robin</span>
          
        <span data-v-59e6cb88>2015 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.jpg" alt="码农沉思录" class="logo"> <span class="site-name">码农沉思录</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/css系统梳理/" class="nav-link"><i class="undefined"></i>
  css系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/css响应式/" class="nav-link"><i class="undefined"></i>
  css响应式
</a></li><li class="dropdown-item"><!----> <a href="/categories/简历/" class="nav-link"><i class="undefined"></i>
  简历
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES系统梳理/" class="nav-link"><i class="undefined"></i>
  ES系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/html5系统梳理/" class="nav-link"><i class="undefined"></i>
  html5系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/js基础/" class="nav-link"><i class="undefined"></i>
  js基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/js面试题/" class="nav-link"><i class="undefined"></i>
  js面试题
</a></li><li class="dropdown-item"><!----> <a href="/categories/jquery源码分析/" class="nav-link"><i class="undefined"></i>
  jquery源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/PMP考试每日一题/" class="nav-link"><i class="undefined"></i>
  PMP考试每日一题
</a></li><li class="dropdown-item"><!----> <a href="/categories/react源码分析/" class="nav-link"><i class="undefined"></i>
  react源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级每日三题/" class="nav-link"><i class="undefined"></i>
  软考高级每日三题
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级解锁打卡/" class="nav-link"><i class="undefined"></i>
  软考高级解锁打卡
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级日历打卡/" class="nav-link"><i class="undefined"></i>
  软考高级日历打卡
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue源码分析/" class="nav-link"><i class="undefined"></i>
  vue源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack前端工程化/" class="nav-link"><i class="undefined"></i>
  webpack前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/categories/聚焦Vue、React、Webpack/" class="nav-link"><i class="undefined"></i>
  聚焦Vue、React、Webpack
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      FriendLink
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lotosv2010/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/lotosv2010/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bokeyuan"></i>
  博客圆
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/lotosv2010" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-document"></i>
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/head.jpg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    Robin
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>49</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>14</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/css系统梳理/" class="nav-link"><i class="undefined"></i>
  css系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/css响应式/" class="nav-link"><i class="undefined"></i>
  css响应式
</a></li><li class="dropdown-item"><!----> <a href="/categories/简历/" class="nav-link"><i class="undefined"></i>
  简历
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES系统梳理/" class="nav-link"><i class="undefined"></i>
  ES系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/html5系统梳理/" class="nav-link"><i class="undefined"></i>
  html5系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/js基础/" class="nav-link"><i class="undefined"></i>
  js基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/js面试题/" class="nav-link"><i class="undefined"></i>
  js面试题
</a></li><li class="dropdown-item"><!----> <a href="/categories/jquery源码分析/" class="nav-link"><i class="undefined"></i>
  jquery源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/PMP考试每日一题/" class="nav-link"><i class="undefined"></i>
  PMP考试每日一题
</a></li><li class="dropdown-item"><!----> <a href="/categories/react源码分析/" class="nav-link"><i class="undefined"></i>
  react源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级每日三题/" class="nav-link"><i class="undefined"></i>
  软考高级每日三题
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级解锁打卡/" class="nav-link"><i class="undefined"></i>
  软考高级解锁打卡
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级日历打卡/" class="nav-link"><i class="undefined"></i>
  软考高级日历打卡
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue源码分析/" class="nav-link"><i class="undefined"></i>
  vue源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack前端工程化/" class="nav-link"><i class="undefined"></i>
  webpack前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/categories/聚焦Vue、React、Webpack/" class="nav-link"><i class="undefined"></i>
  聚焦Vue、React、Webpack
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      FriendLink
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lotosv2010/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/lotosv2010/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bokeyuan"></i>
  博客圆
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/lotosv2010" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-document"></i>
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>vue源码分析(十三) 编译之optimize</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Robin</span>
          
        <span data-v-59e6cb88>2015 - </span>
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">vue源码分析(十三) 编译之optimize</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>Robin</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>10/13/2018</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>vue</span><span class="tag-item" data-v-8a445198>源码分析</span><span class="tag-item" data-v-8a445198>面试</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-概述"><a href="#_1-概述" class="header-anchor">#</a> 1. 概述</h2> <p>​	我们在 <strong><a href="https://lotosv2010.github.io/view/vue/2018/10080800.html#_4-3-basecompile" target="_blank" rel="noopener noreferrer">vue源码分析(八) 编译之整体流程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong> 中分析过了编译的三个过程，即解析模板字符串生成 <code>AST</code>、优化语法树、生成代码，这一章我们主要来讲解第二部分——优化 <code>AST</code> 树。</p> <p>​	为什么要优化 <code>AST</code> 树，我们先看一下官方的解释，如下：</p> <p>​	源码目录：<code>src/compiler/optimizer.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * Goal of the optimizer: walk the generated template AST tree
 * and detect sub-trees that are purely static, i.e. parts of
 * the DOM that never needs to change.
 *
 * Once we detect these sub-trees, we can:
 *
 * 1. Hoist them into constants, so that we no longer need to
 *    create fresh nodes for them on each re-render;
 * 2. Completely skip them in the patching process.
 */</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>​	我们把这段注释翻译成中文，如下：</p> <div class="custom-block tip"><p class="title"></p><p>优化器的目标
遍历生成的模板AST树，检测纯静态的子树，即永远不需要更改的DOM。
一旦我们检测到这些子树，我们可以:
1、把它们变成常数，这样我们就不需要了在每次重新渲染时为它们创建新的节点
2、在修补过程中完全跳过它们。</p></div><p>​	从注释我们大致知道，<code>optimize</code> 的作用，我们知道 <code>vue</code> 是数据驱动，是响应式的，但是我们的模板并不是所有数据都是响应式的，也有很多数据是首次渲染后就永远不会变化的，那么这部分数据生成的 <code>DOM</code> 也不会变化，我们可以在 <code>patch</code> 的过程跳过对他们的比对，提高性能。</p> <p>​	所以 <code>optimize</code> 主要进行静态标注。下面我们从源码的角度分析，什么是静态标注？如何进行静态标注？</p> <h2 id="_2-optimize"><a href="#_2-optimize" class="header-anchor">#</a> 2. <code>optimize</code></h2> <p>​	首先我们看一下 <code>optimize</code> 定义，如下：</p> <p>​	源码目录：<code>src/compiler/optimizer.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">optimize</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token operator">?</span>ASTElement<span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> CompilerOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token keyword">return</span>
  isStaticKey <span class="token operator">=</span> <span class="token function">genStaticKeysCached</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>staticKeys <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span>
  isPlatformReservedTag <span class="token operator">=</span> options<span class="token punctuation">.</span>isReservedTag <span class="token operator">||</span> no
  <span class="token comment">// first pass: mark all non-static nodes.</span>
  <span class="token function">markStatic</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
  <span class="token comment">// second pass: mark static roots.</span>
  <span class="token function">markStaticRoots</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​	在分析之前，我们还是以一个案例进行讲解，如下：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>classObject<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(l, i) in list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>clickItem(index)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ i }}:{{ l }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​	上面的模板，通过上一章的parse函数的解析生成的ast树为，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">attrsList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;v-show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">attrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;classObject&quot;</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> v<span class="token operator">-</span>show<span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;l&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attrsList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;@click&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;clickItem(index)&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">136</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">:</span> <span class="token string">&quot;(l, i) in list&quot;</span><span class="token punctuation">,</span> <span class="token operator">:</span>key<span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span> @click<span class="token operator">:</span> <span class="token string">&quot;clickItem(index)&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">152</span>
        <span class="token literal-property property">expression</span><span class="token operator">:</span> <span class="token string">&quot;_s(i)+&quot;</span><span class="token operator">:</span><span class="token string">&quot;+_s(l)&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">137</span><span class="token punctuation">,</span>
        <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&quot;{{ i }}:{{ l }}&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">tokens</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>@binding<span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span>@binding<span class="token operator">:</span> <span class="token string">&quot;l&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">157</span><span class="token punctuation">,</span>
      <span class="token literal-property property">events</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">click</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;clickItem(index)&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">dynamic</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">136</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">for</span><span class="token operator">:</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">forProcessed</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hasBindings</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">iterator1</span><span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">/*省略 ul*/</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plain</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pre</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      <span class="token literal-property property">rawAttrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">:</span>key<span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">,</span> @click<span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>i<span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">refInFor</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">67</span><span class="token punctuation">,</span>
      <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">classBinding</span><span class="token operator">:</span> <span class="token string">&quot;classObject&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">directives</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">rawName</span><span class="token operator">:</span> <span class="token string">&quot;v-show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">arg</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">isDynamicArg</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">modifiers</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">173</span><span class="token punctuation">,</span>
  <span class="token literal-property property">hasBindings</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plain</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rawAttrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;:class&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;classObject&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">}</span>
    <span class="token keyword">class</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">}</span>
    v<span class="token operator">-</span>show<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;v-show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">staticClass</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>list<span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&quot;ul&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>​	首先判断 <code>root</code> 即 <code>AST</code> 树存不存在，如果不存在直接返回，如果存在接下来调用 <code>genStaticKeysCached</code> 缓存了所有静态标签，赋值给 <code>isStaticKey</code>。</p> <p>​	接下获取判断是否是保留的标签的函数，赋值给变量 <code>isPlatformReservedTag</code>。</p> <div class="custom-block danger"><p class="title"></p><p>说明：关于 <code>genStaticKeysCached</code> 和 <code>isReservedTag</code>我们在后面小节中单独分析。</p></div><p>​	我们继续往下看，接下来是调用 <code>markStatic(root)</code> 标记所有非静态节点和调用 <code>markStaticRoots(root, false)</code>标记静态 <code>root</code> 节点。</p> <div class="custom-block danger"><p class="title"></p><p>说明：关于<code>markStatic</code> 和 <code>markStaticRoots</code>我们在后面小节中单独分析。</p></div><h3 id="_2-1-isreservedtag"><a href="#_2-1-isreservedtag" class="header-anchor">#</a> 2.1 <code>isReservedTag</code></h3> <p>​	<code>isReservedTag</code> 是从 <code>options</code> 配置中获取的，在 **<a href="https://lotosv2010.github.io/view/vue/2018/10080800.html#_4-4-baseoptions" target="_blank" rel="noopener noreferrer">vue源码分析(八) 编译之整体流程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>**中我们分析过 <code>baseOptions</code> 的源码，知道 <code>isReservedTag</code> 的作用是检查给定的标签是否是保留的标签， 源码如下：</p> <p>​	源码目录：<code>src/platforms/web/util/element.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> isReservedTag <span class="token operator">=</span> <span class="token punctuation">(</span>tag<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token parameter">boolean</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">isHTMLTag</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isSVG</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​	其中 <code>isHTMLTag</code> 和 <code>isSVG</code> 的定义如下：</p> <p>​	源码目录：<code>src/platforms/web/util/element.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// html 保留标签</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> isHTMLTag <span class="token operator">=</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>
  <span class="token string">'html,body,base,head,link,meta,style,title,'</span> <span class="token operator">+</span>
  <span class="token string">'address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,'</span> <span class="token operator">+</span>
  <span class="token string">'div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,'</span> <span class="token operator">+</span>
  <span class="token string">'a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,'</span> <span class="token operator">+</span>
  <span class="token string">'s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,'</span> <span class="token operator">+</span>
  <span class="token string">'embed,object,param,source,canvas,script,noscript,del,ins,'</span> <span class="token operator">+</span>
  <span class="token string">'caption,col,colgroup,table,thead,tbody,td,th,tr,'</span> <span class="token operator">+</span>
  <span class="token string">'button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,'</span> <span class="token operator">+</span>
  <span class="token string">'output,progress,select,textarea,'</span> <span class="token operator">+</span>
  <span class="token string">'details,dialog,menu,menuitem,summary,'</span> <span class="token operator">+</span>
  <span class="token string">'content,element,shadow,template,blockquote,iframe,tfoot'</span>
<span class="token punctuation">)</span>

<span class="token comment">// this map is intentionally selective, only covering SVG elements that may</span>
<span class="token comment">// contain child elements.</span>
<span class="token comment">// svg保留标签</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> isSVG <span class="token operator">=</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>
  <span class="token string">'svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,'</span> <span class="token operator">+</span>
  <span class="token string">'foreignObject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,'</span> <span class="token operator">+</span>
  <span class="token string">'polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view'</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>​	这里只要知道 <code>isHTMLTag</code> 和 <code>isSVG</code>  通过 <code>makeMap</code> 产生的， <code>makeMap</code> 的作用是根据 <code>str</code>, 生成一个<code>map</code>, 然后返回一个方法, 这个方法的作用是, 判断一个值是否在这个生成的 <code>map</code> 中。</p> <h3 id="_2-2-makemap"><a href="#_2-2-makemap" class="header-anchor">#</a> 2.2 <code>makeMap</code></h3> <p>​	上面分析我们知道了 <code>makeMap</code>的作用，接下来我们看一下 <code>makeMap</code> 的定义，如下：</p> <p>​	源码目录：<code>src/shared/util.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">makeMap</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">str</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  expectsLowerCase<span class="token operator">?</span><span class="token operator">:</span> boolean</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">key</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建一个空对象</span>
  <span class="token keyword">const</span> map <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token comment">// 通过 `,` 将字符串分割成数组，例如：[type,tag,attrsList,attrsMap,plain]</span>
  <span class="token keyword">const</span> <span class="token literal-property property">list</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
  <span class="token comment">// 通过for循环将数组中的每一项作为对象的健，`true`作为值，给对象添加相应的属性</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">[</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 返回一个检查传递进来的参数是否在此对象中的函数</span>
  <span class="token keyword">return</span> expectsLowerCase
    <span class="token operator">?</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> map<span class="token punctuation">[</span>val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token operator">:</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> map<span class="token punctuation">[</span>val<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>​	最终返回的值一个函数，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> map<span class="token punctuation">[</span>val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-3-genstatickeyscached"><a href="#_2-3-genstatickeyscached" class="header-anchor">#</a> 2.3 <code>genStaticKeysCached</code></h3> <p>​	我们来看看 <code>genStaticKeysCached</code> 的实现，源码如下：</p> <p>​	源码目录：<code>src/compiler/optimizer.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> genStaticKeysCached <span class="token operator">=</span> <span class="token function">cached</span><span class="token punctuation">(</span>genStaticKeys<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​	<code>genStaticKeysCached</code> 通过我们前面分析过的 <code>cached</code> 函数来实现，参数是 <code>genStaticKeys</code>  函数，我们先看一下 <code>genStaticKeys</code> 的定义，再来回顾一下 <code>cached</code> 的实现，源码如下：</p> <p>​	源码目录：<code>src/compiler/optimizer.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">genStaticKeys</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">keys</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>
    <span class="token string">'type,tag,attrsList,attrsMap,plain,parent,children,attrs,start,end,rawAttrsMap'</span> <span class="token operator">+</span>
    <span class="token punctuation">(</span>keys <span class="token operator">?</span> <span class="token string">','</span> <span class="token operator">+</span> keys <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​	 前面我们已经分析过了 <code>makeMap</code> 的作用。在这里上面的字符串中 <code>keys</code> 为 <code>staticClass,staticStyle</code>，所以最后的字符串为 <code>type,tag,attrsList,attrsMap,plain,parent,children,attrs,start,end,rawAttrsMap,staticClass,staticStyle</code>，然后通过 <code>makeMap</code> 生成一个闭包，如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">tag</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">attrsList</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">attrsMap</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">plain</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">parent</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">attrs</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">start</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">end</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">rawAttrsMap</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">staticClass</span><span class="token operator">:</span> ture<span class="token punctuation">,</span>
    <span class="token literal-property property">staticStyle</span><span class="token operator">:</span> ture
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> map<span class="token punctuation">[</span>val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_2-4-cached"><a href="#_2-4-cached" class="header-anchor">#</a> 2.4 <code>cached</code></h3> <p>​	我们先来看一下 <code>cached</code> 的定义如下：</p> <p>​	源码目录：<code>src/shared/util.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> cached<span class="token operator">&lt;</span><span class="token constant">F</span><span class="token operator">:</span> Function<span class="token operator">&gt;</span> <span class="token punctuation">(</span>fn<span class="token operator">:</span> <span class="token constant">F</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">F</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建一个空对象</span>
  <span class="token keyword">const</span> cache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">cachedFn</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">str</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token comment">// 获取缓存对象str属性的值</span>
    <span class="token keyword">const</span> hit <span class="token operator">=</span> cache<span class="token punctuation">[</span>str<span class="token punctuation">]</span> 
    <span class="token comment">// 如果该值存在，直接返回，不存在调用一次fn，然后将结果存放到缓存对象中</span>
    <span class="token keyword">return</span> hit <span class="token operator">||</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>str<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
  <span class="token punctuation">}</span><span class="token operator">:</span> any<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>​	<code>cached</code> 方法接受一个参数为函数，其会将该传入 <code>fn</code> 函数的运行结果缓存，返回一个函数 <code>cachedFn</code>，函数内部先获取调用该函数 <code>cachedFn</code> 传入的参数 <code>str</code> 在缓存对象 <code>cache</code> 中的的值，如果在缓存对象 <code>cache</code> 中有值，直接返回该值，否则调用 <code>cached</code> 函数中传入的方法 <code>fn</code> ，然后将运行结果存到 <code>cache</code> 中。这样如果 <code>cachedFn</code> 调用两次，第一次要执行一次 <code>fn</code> ，并将其运行结果缓存起来，当第二次调用 <code>cachedFn</code> 并且参数 <code>str</code> 与之前调用过的一致的时候，直接从缓存对象 <code>cache</code> 中获取结果，这样就不用再一次调用 <code>fn</code> 方法，节省一次函数的运行。</p> <p>​	通过上面的分析，我们知道在编译阶段可以把一些 <code>AST</code>节点优化成静态节点，所以整个 <code>optimize</code> 的过程实际上就干 2 件事情，<code>markStatic(root)</code> 标记静态节点 ，<code>markStaticRoots(root, false)</code> 标记静态根。</p> <p>​	接下来我们分析这两件事执行的代码逻辑。</p> <h2 id="_3-markstatic"><a href="#_3-markstatic" class="header-anchor">#</a> 3. <code>markStatic</code></h2> <p>​	我们来看一下<code>markStatic</code>的定义，如下：</p> <p>​	源码目录：<code>src/compiler/optimizer.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">markStatic</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> ASTNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  node<span class="token punctuation">.</span>static <span class="token operator">=</span> <span class="token function">isStatic</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do not make component slot content static. this avoids</span>
    <span class="token comment">// 1. components not able to mutate slot nodes</span>
    <span class="token comment">// 2. static slot content fails for hot-reloading</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      <span class="token operator">!</span><span class="token function">isPlatformReservedTag</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      node<span class="token punctuation">.</span>tag <span class="token operator">!==</span> <span class="token string">'slot'</span> <span class="token operator">&amp;&amp;</span>
      node<span class="token punctuation">.</span>attrsMap<span class="token punctuation">[</span><span class="token string">'inline-template'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> child <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token function">markStatic</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>child<span class="token punctuation">.</span>static<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>static <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> l <span class="token operator">=</span> node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> block <span class="token operator">=</span> node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>block
        <span class="token function">markStatic</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>block<span class="token punctuation">.</span>static<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          node<span class="token punctuation">.</span>static <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>​	从上面的代码我们可以看出，<code>markStatic</code> 函数的主要作用是标注节点的状态和对标签节点进行处理，下面我们就详细分析一下这两个过程。</p> <h3 id="_3-1-标注节点的状态"><a href="#_3-1-标注节点的状态" class="header-anchor">#</a> 3.1 标注节点的状态</h3> <p>​	首先看标记静态节点的 <code>markStatic</code> 这个方法，如下：</p> <p>​	源码目录：<code>src/compiler/optimizer.js</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>node<span class="token punctuation">.</span>static <span class="token operator">=</span> <span class="token function">isStatic</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​	<code>markStatic</code> 一开始通过调用 <code>isStatic</code> 进行标注节点的状态，下面我们来分析<code>isStatic</code>，源码如下：</p> <p>​	源码目录：<code>src/compiler/optimizer.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isStatic</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> ASTNode</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// expression</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// text</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>pre <span class="token operator">||</span> <span class="token punctuation">(</span>
    <span class="token operator">!</span>node<span class="token punctuation">.</span>hasBindings <span class="token operator">&amp;&amp;</span> <span class="token comment">// no dynamic bindings</span>
    <span class="token operator">!</span>node<span class="token punctuation">.</span>if <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>node<span class="token punctuation">.</span>for <span class="token operator">&amp;&amp;</span> <span class="token comment">// not v-if or v-for or v-else</span>
    <span class="token operator">!</span><span class="token function">isBuiltInTag</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// not a built-in</span>
    <span class="token function">isPlatformReservedTag</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// not a component</span>
    <span class="token operator">!</span><span class="token function">isDirectChildOfTemplateFor</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>isStaticKey<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>​	<code>isStatic</code> 函数主要的作用是：</p> <ol><li>判断节点类型为表达式，标注为非静态。</li> <li>判断节点类型为普通文本，标注为静态。</li> <li><code>v-pre</code> 指令(无需编译)标注为静态，或者满足以下条件，也标注为静态。
<ul><li>(1) 无动态绑定；</li> <li>(2) 没有 <code>v-if</code> 和 <code>v-for</code> ；</li> <li>(3) 不是内置的标签，内置的标签有<code>slot</code>和<code>component</code> ；</li> <li>(4) 是平台保留标签(<code>html</code>和<code>svg</code>标签)；</li> <li>(5) 不是 <code>template</code> 标签的直接子元素并且没有包含在<code>for</code>循环中；</li> <li>(6) 结点包含的属性只能有<code>isStaticKey</code>中指定的几个；</li></ul></li></ol> <h3 id="_3-2-对标签节点进行处理"><a href="#_3-2-对标签节点进行处理" class="header-anchor">#</a> 3.2 对标签节点进行处理</h3> <p>​	分析完 <code>isStatic</code> 我们再回到 <code>markStatic</code>，继续往下看，接下的代码是对标签节点进行处理。</p> <p>​	首先判断节点类型为1即<strong>普通元素</strong>，则执行 <code>if</code> 语句中的代码。</p> <div class="custom-block tip"><p class="title"></p><p>说明：<code>AST</code> 元素节点总共有 <code>3</code> 种类型， <code>type</code> 为 <code>1</code> 表示是<strong>普通元素</strong>，为<code>2</code> 表示是<strong>表达式</strong>，为 <code>3</code> 表示是<strong>纯文本</strong>。</p></div><p>​	接下来又是一个 <code>if</code> 语句，成立的条件是既<strong>不是平台保留标签(<code>html,svg</code>)<strong>也</strong>不是<code>slot</code>标签</strong>又<strong>不是一个内联模板容器</strong>，此段代码的作用是对 <code>slot</code> 内容不做递归标注，直接返回。</p> <p>​	继续往下看，紧接着是一个 <code>for</code> 循环子节点，进行递归标注，如果子节点为非静态，那么该节点也要标注非静态。所以整个标注过程是自下而上，先标注子节点，然后再是父节点，一层一层往上回溯。</p> <p>​	最后因为所有的 <code>elseif</code> 和 <code>else</code> 节点都不在 <code>children</code> 中， 如果节点的 <code>ifConditions</code> 不为空，则遍历 <code>ifConditions</code> 拿到所有条件中的  <code>block</code>，也就是它们对应的 <code>AST</code> 节点，递归执行 <code>markStatic</code> 。在这些递归过程中，一旦子节点有不是 <code>static</code> 的情况，则它的父节点的<code>static</code> 均变成 <code>false</code>。</p> <p>​	通过调用 <code>markStatic</code> 函数处理过的 <code>ast</code> 树如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">attrsList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;v-show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">attrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;classObject&quot;</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> v<span class="token operator">-</span>show<span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;l&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attrsList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;@click&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;clickItem(index)&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">136</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">:</span> <span class="token string">&quot;(l, i) in list&quot;</span><span class="token punctuation">,</span> <span class="token operator">:</span>key<span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span> @click<span class="token operator">:</span> <span class="token string">&quot;clickItem(index)&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">152</span>
        <span class="token literal-property property">expression</span><span class="token operator">:</span> <span class="token string">&quot;_s(i)+&quot;</span><span class="token operator">:</span><span class="token string">&quot;+_s(l)&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">137</span><span class="token punctuation">,</span>
        <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&quot;{{ i }}:{{ l }}&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">tokens</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>@binding<span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span>@binding<span class="token operator">:</span> <span class="token string">&quot;l&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">157</span><span class="token punctuation">,</span>
      <span class="token literal-property property">events</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">click</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;clickItem(index)&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">dynamic</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">136</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">for</span><span class="token operator">:</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">forProcessed</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hasBindings</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">iterator1</span><span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">/*省略 ul*/</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plain</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pre</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      <span class="token literal-property property">rawAttrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">:</span>key<span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">,</span> @click<span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>i<span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">refInFor</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">67</span><span class="token punctuation">,</span>
      <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">classBinding</span><span class="token operator">:</span> <span class="token string">&quot;classObject&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">directives</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">rawName</span><span class="token operator">:</span> <span class="token string">&quot;v-show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">arg</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">isDynamicArg</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">modifiers</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">173</span><span class="token punctuation">,</span>
  <span class="token literal-property property">hasBindings</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plain</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rawAttrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;:class&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;classObject&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">}</span>
    <span class="token keyword">class</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">}</span>
    v<span class="token operator">-</span>show<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;v-show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">staticClass</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>list<span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&quot;ul&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>​	我们发现每一个 <code>AST</code> 元素节点都多了 <code>staic</code> 属性。</p> <h2 id="_4-markstaticroots"><a href="#_4-markstaticroots" class="header-anchor">#</a> 4. <code>markStaticRoots</code></h2> <p>​	我们继续看 <code>markStaticRoots</code> 函数的定义，如下：</p> <p>​	源码目录：<code>src/compiler/optimizer.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">markStaticRoots</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> ASTNode<span class="token punctuation">,</span> <span class="token literal-property property">isInFor</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>static <span class="token operator">||</span> node<span class="token punctuation">.</span>once<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>staticInFor <span class="token operator">=</span> isInFor
    <span class="token punctuation">}</span>
    <span class="token comment">// For a node to qualify as a static root, it should have children that</span>
    <span class="token comment">// are not just static text. Otherwise the cost of hoisting out will</span>
    <span class="token comment">// outweigh the benefits and it's better off to just always render it fresh.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>static <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>
      node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span>
      node<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>staticRoot <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>staticRoot <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">markStaticRoots</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> isInFor <span class="token operator">||</span> <span class="token operator">!</span><span class="token operator">!</span>node<span class="token punctuation">.</span>for<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> l <span class="token operator">=</span> node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">markStaticRoots</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>block<span class="token punctuation">,</span> isInFor<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>​	<code>markStaticRoots</code> 第二个参数是 <code>isInFor</code> ，对于已经是 <code>static</code> 的节点或者是 <code>v-once</code> 指令的节点，<code>node.staticInFor = isInFor</code> 。 接着就是对于 <code>staticRoot</code> 的判断逻辑，从注释中我们可以看到，对于有资格成为 <code>staticRoot</code> 的节点，除了本身是一个静态节点外，必须满足拥有 <code>children</code>	，并且 <code>children</code> 不能只是一个文本节点，不然的话把它标记成静态根节点的收益就很小了。</p> <p>​	接下来和标记静态节点的逻辑一样，遍历 <code>children</code> 以及 <code>ifConditions</code> ，递归执行 <code>markStaticRoots</code> 。</p> <p>​	通过调用 <code>markStaticRoots</code> 函数处理过的 <code>ast</code> 树如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">attrsList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;v-show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">attrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;classObject&quot;</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> v<span class="token operator">-</span>show<span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;l&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attrsList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;@click&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;clickItem(index)&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">136</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">:</span> <span class="token string">&quot;(l, i) in list&quot;</span><span class="token punctuation">,</span> <span class="token operator">:</span>key<span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span> @click<span class="token operator">:</span> <span class="token string">&quot;clickItem(index)&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">152</span>
        <span class="token literal-property property">expression</span><span class="token operator">:</span> <span class="token string">&quot;_s(i)+&quot;</span><span class="token operator">:</span><span class="token string">&quot;+_s(l)&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">137</span><span class="token punctuation">,</span>
        <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&quot;{{ i }}:{{ l }}&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">tokens</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>@binding<span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span>@binding<span class="token operator">:</span> <span class="token string">&quot;l&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">157</span><span class="token punctuation">,</span>
      <span class="token literal-property property">events</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">click</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;clickItem(index)&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">dynamic</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">136</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">for</span><span class="token operator">:</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">forProcessed</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hasBindings</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">iterator1</span><span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">/*省略 ul*/</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plain</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pre</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      <span class="token literal-property property">rawAttrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">:</span>key<span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">,</span> @click<span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>i<span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">refInFor</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">67</span><span class="token punctuation">,</span>
      <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">staticRoot</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">classBinding</span><span class="token operator">:</span> <span class="token string">&quot;classObject&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">directives</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">rawName</span><span class="token operator">:</span> <span class="token string">&quot;v-show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">arg</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">isDynamicArg</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">modifiers</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">173</span><span class="token punctuation">,</span>
  <span class="token literal-property property">hasBindings</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parent</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plain</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rawAttrsMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;:class&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;classObject&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">}</span>
    <span class="token keyword">class</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">}</span>
    v<span class="token operator">-</span>show<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;v-show&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;isShow&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">staticClass</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>list<span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">staticRoot</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&quot;ul&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>​	我们发现 <code>type</code> 为 <code>1</code> 的普通元素 <code>AST</code> 节点多了 <code>staticRoot</code> 属性。</p> <h2 id="_5-总结"><a href="#_5-总结" class="header-anchor">#</a> 5. 总结</h2> <p>​	至此我们分析完了 <code>optimize</code> 的过程，就是深度遍历这个 <code>AST</code> 树，去检测它的每一颗子树是不是静态节点，如果是静态节点则它们生成 <code>DOM</code> 永远不需要改变，这对运行时对模板的更新起到极大的优化作用。</p> <p>​		我们通过 <code>optimize</code> 我们把整个 <code>AST</code> 树中的每一个 <code>AST</code> 元素节点标记了 <code>static</code> 和 <code>staticRoot</code> ，它会影响我们接下来执行代码生成的过程。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/view/vue/2018/10130800.html#_1-概述" class="sidebar-link reco-side-_1-概述" data-v-b57cc07c>1. 概述</a></li><li class="level-2" data-v-b57cc07c><a href="/view/vue/2018/10130800.html#_2-optimize" class="sidebar-link reco-side-_2-optimize" data-v-b57cc07c>2. optimize</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10130800.html#_2-1-isreservedtag" class="sidebar-link reco-side-_2-1-isreservedtag" data-v-b57cc07c>2.1 isReservedTag</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10130800.html#_2-2-makemap" class="sidebar-link reco-side-_2-2-makemap" data-v-b57cc07c>2.2 makeMap</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10130800.html#_2-3-genstatickeyscached" class="sidebar-link reco-side-_2-3-genstatickeyscached" data-v-b57cc07c>2.3 genStaticKeysCached</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10130800.html#_2-4-cached" class="sidebar-link reco-side-_2-4-cached" data-v-b57cc07c>2.4 cached</a></li><li class="level-2" data-v-b57cc07c><a href="/view/vue/2018/10130800.html#_3-markstatic" class="sidebar-link reco-side-_3-markstatic" data-v-b57cc07c>3. markStatic</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10130800.html#_3-1-标注节点的状态" class="sidebar-link reco-side-_3-1-标注节点的状态" data-v-b57cc07c>3.1 标注节点的状态</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10130800.html#_3-2-对标签节点进行处理" class="sidebar-link reco-side-_3-2-对标签节点进行处理" data-v-b57cc07c>3.2 对标签节点进行处理</a></li><li class="level-2" data-v-b57cc07c><a href="/view/vue/2018/10130800.html#_4-markstaticroots" class="sidebar-link reco-side-_4-markstaticroots" data-v-b57cc07c>4. markStaticRoots</a></li><li class="level-2" data-v-b57cc07c><a href="/view/vue/2018/10130800.html#_5-总结" class="sidebar-link reco-side-_5-总结" data-v-b57cc07c>5. 总结</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.ad2c5d61.js" defer></script><script src="/assets/js/4.82f582a9.js" defer></script><script src="/assets/js/1.72e48573.js" defer></script><script src="/assets/js/54.5a34c05b.js" defer></script>
  </body>
</html>
