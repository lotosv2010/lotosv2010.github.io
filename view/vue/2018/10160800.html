<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue源码分析(十六) 选项合并之合并策略 | 码农沉思录</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/favicon.jpg">
    <meta name="description" content="代码千万行, 注释第一行, 编码不规范, 同事两行泪">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.92019516.css" as="style"><link rel="preload" href="/assets/js/app.ad2c5d61.js" as="script"><link rel="preload" href="/assets/js/4.82f582a9.js" as="script"><link rel="preload" href="/assets/js/1.72e48573.js" as="script"><link rel="preload" href="/assets/js/57.079ff0b7.js" as="script"><link rel="prefetch" href="/assets/js/10.6bbbb4af.js"><link rel="prefetch" href="/assets/js/11.84886e2e.js"><link rel="prefetch" href="/assets/js/12.6ab8637d.js"><link rel="prefetch" href="/assets/js/13.ea9ef3eb.js"><link rel="prefetch" href="/assets/js/14.865dcee3.js"><link rel="prefetch" href="/assets/js/15.49d2e55e.js"><link rel="prefetch" href="/assets/js/16.0b37b058.js"><link rel="prefetch" href="/assets/js/17.e5cd5fdd.js"><link rel="prefetch" href="/assets/js/18.85dd604a.js"><link rel="prefetch" href="/assets/js/19.f588c03c.js"><link rel="prefetch" href="/assets/js/20.33d127dd.js"><link rel="prefetch" href="/assets/js/21.2726927d.js"><link rel="prefetch" href="/assets/js/22.95f3f4a3.js"><link rel="prefetch" href="/assets/js/23.d8a538a6.js"><link rel="prefetch" href="/assets/js/24.17ad2529.js"><link rel="prefetch" href="/assets/js/25.f51b2675.js"><link rel="prefetch" href="/assets/js/26.934ec669.js"><link rel="prefetch" href="/assets/js/27.72508c77.js"><link rel="prefetch" href="/assets/js/28.2b0959c4.js"><link rel="prefetch" href="/assets/js/29.1c963303.js"><link rel="prefetch" href="/assets/js/30.8e399044.js"><link rel="prefetch" href="/assets/js/31.e4928ff3.js"><link rel="prefetch" href="/assets/js/32.c6b6ef8d.js"><link rel="prefetch" href="/assets/js/33.ddfa1e4c.js"><link rel="prefetch" href="/assets/js/34.3e4256dd.js"><link rel="prefetch" href="/assets/js/35.8a92b27b.js"><link rel="prefetch" href="/assets/js/36.4167114e.js"><link rel="prefetch" href="/assets/js/37.11de70c3.js"><link rel="prefetch" href="/assets/js/38.51bfcef9.js"><link rel="prefetch" href="/assets/js/39.391d16d4.js"><link rel="prefetch" href="/assets/js/40.75c9b958.js"><link rel="prefetch" href="/assets/js/41.adff1d44.js"><link rel="prefetch" href="/assets/js/42.b18f2f3c.js"><link rel="prefetch" href="/assets/js/43.39857e56.js"><link rel="prefetch" href="/assets/js/44.8d646eb3.js"><link rel="prefetch" href="/assets/js/45.8696e081.js"><link rel="prefetch" href="/assets/js/46.6b1aef3a.js"><link rel="prefetch" href="/assets/js/47.6c8a36c8.js"><link rel="prefetch" href="/assets/js/48.c54441d1.js"><link rel="prefetch" href="/assets/js/49.902cc547.js"><link rel="prefetch" href="/assets/js/5.ebb7f635.js"><link rel="prefetch" href="/assets/js/50.b6dd2518.js"><link rel="prefetch" href="/assets/js/51.ebec3ecf.js"><link rel="prefetch" href="/assets/js/52.5a757ff9.js"><link rel="prefetch" href="/assets/js/53.381b38f6.js"><link rel="prefetch" href="/assets/js/54.5a34c05b.js"><link rel="prefetch" href="/assets/js/55.a7716bd5.js"><link rel="prefetch" href="/assets/js/56.30b8e2e3.js"><link rel="prefetch" href="/assets/js/58.23b4a501.js"><link rel="prefetch" href="/assets/js/59.f41538da.js"><link rel="prefetch" href="/assets/js/6.d3a9d217.js"><link rel="prefetch" href="/assets/js/60.8801415c.js"><link rel="prefetch" href="/assets/js/61.296117b6.js"><link rel="prefetch" href="/assets/js/62.0380b2ff.js"><link rel="prefetch" href="/assets/js/63.4e82cbaa.js"><link rel="prefetch" href="/assets/js/7.6156d368.js"><link rel="prefetch" href="/assets/js/8.1c82c0e7.js"><link rel="prefetch" href="/assets/js/9.3648f843.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.83298789.js">
    <link rel="stylesheet" href="/assets/css/0.styles.92019516.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>码农沉思录</h3> <p class="description" data-v-59e6cb88>代码千万行, 注释第一行, 编码不规范, 同事两行泪</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Robin</span>
          
        <span data-v-59e6cb88>2015 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.jpg" alt="码农沉思录" class="logo"> <span class="site-name">码农沉思录</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/css系统梳理/" class="nav-link"><i class="undefined"></i>
  css系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/css响应式/" class="nav-link"><i class="undefined"></i>
  css响应式
</a></li><li class="dropdown-item"><!----> <a href="/categories/简历/" class="nav-link"><i class="undefined"></i>
  简历
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES系统梳理/" class="nav-link"><i class="undefined"></i>
  ES系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/html5系统梳理/" class="nav-link"><i class="undefined"></i>
  html5系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/js基础/" class="nav-link"><i class="undefined"></i>
  js基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/js面试题/" class="nav-link"><i class="undefined"></i>
  js面试题
</a></li><li class="dropdown-item"><!----> <a href="/categories/jquery源码分析/" class="nav-link"><i class="undefined"></i>
  jquery源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/PMP考试每日一题/" class="nav-link"><i class="undefined"></i>
  PMP考试每日一题
</a></li><li class="dropdown-item"><!----> <a href="/categories/react源码分析/" class="nav-link"><i class="undefined"></i>
  react源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级每日三题/" class="nav-link"><i class="undefined"></i>
  软考高级每日三题
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级解锁打卡/" class="nav-link"><i class="undefined"></i>
  软考高级解锁打卡
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级日历打卡/" class="nav-link"><i class="undefined"></i>
  软考高级日历打卡
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue源码分析/" class="nav-link"><i class="undefined"></i>
  vue源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack前端工程化/" class="nav-link"><i class="undefined"></i>
  webpack前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/categories/聚焦Vue、React、Webpack/" class="nav-link"><i class="undefined"></i>
  聚焦Vue、React、Webpack
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      FriendLink
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lotosv2010/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/lotosv2010/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bokeyuan"></i>
  博客圆
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/lotosv2010" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-document"></i>
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/head.jpg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    Robin
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>49</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>14</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/css系统梳理/" class="nav-link"><i class="undefined"></i>
  css系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/css响应式/" class="nav-link"><i class="undefined"></i>
  css响应式
</a></li><li class="dropdown-item"><!----> <a href="/categories/简历/" class="nav-link"><i class="undefined"></i>
  简历
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES系统梳理/" class="nav-link"><i class="undefined"></i>
  ES系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/html5系统梳理/" class="nav-link"><i class="undefined"></i>
  html5系统梳理
</a></li><li class="dropdown-item"><!----> <a href="/categories/js基础/" class="nav-link"><i class="undefined"></i>
  js基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/js面试题/" class="nav-link"><i class="undefined"></i>
  js面试题
</a></li><li class="dropdown-item"><!----> <a href="/categories/jquery源码分析/" class="nav-link"><i class="undefined"></i>
  jquery源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/PMP考试每日一题/" class="nav-link"><i class="undefined"></i>
  PMP考试每日一题
</a></li><li class="dropdown-item"><!----> <a href="/categories/react源码分析/" class="nav-link"><i class="undefined"></i>
  react源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级每日三题/" class="nav-link"><i class="undefined"></i>
  软考高级每日三题
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级解锁打卡/" class="nav-link"><i class="undefined"></i>
  软考高级解锁打卡
</a></li><li class="dropdown-item"><!----> <a href="/categories/软考高级日历打卡/" class="nav-link"><i class="undefined"></i>
  软考高级日历打卡
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue源码分析/" class="nav-link"><i class="undefined"></i>
  vue源码分析
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack前端工程化/" class="nav-link"><i class="undefined"></i>
  webpack前端工程化
</a></li><li class="dropdown-item"><!----> <a href="/categories/聚焦Vue、React、Webpack/" class="nav-link"><i class="undefined"></i>
  聚焦Vue、React、Webpack
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      FriendLink
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lotosv2010/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/lotosv2010/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bokeyuan"></i>
  博客圆
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/lotosv2010" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-document"></i>
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>vue源码分析(十六) 选项合并之合并策略</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Robin</span>
          
        <span data-v-59e6cb88>2015 - </span>
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">vue源码分析(十六) 选项合并之合并策略</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>Robin</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>10/16/2018</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>vue</span><span class="tag-item" data-v-8a445198>源码分析</span><span class="tag-item" data-v-8a445198>面试</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-概述"><a href="#_1-概述" class="header-anchor">#</a> 1. 概述</h2> <p>​	上一章我们分析了 <code>Vue</code> 选项合并中的规范化，在这一章中我们重点来看看<code>Vue</code> 选项合并中的合并策略。</p> <p>​	在分析之前，我们还是以上一章的案例进行讲解，如下：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>vue 源码分析<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../../dist/vue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token comment">// Vue.config.devtools = true</span>
      <span class="token comment">// Vue.config.performance = true</span>
      <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
          &lt;div&gt; {{ name }} &lt;/div&gt;
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'robin'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>​	我们继续往下看，接下来是一段如下的代码：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mergeOptions</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parent</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  <span class="token literal-property property">child</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Object <span class="token punctuation">{</span>
  <span class="token comment">/*省略...*/</span>
  <span class="token comment">// Apply extends and mixins on the child options,</span>
  <span class="token comment">// but only if it is a raw options object that isn't</span>
  <span class="token comment">// the result of another mergeOptions call.</span>
  <span class="token comment">// Only merged options has the _base property.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>child<span class="token punctuation">.</span>_base<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>extends<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      parent <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> child<span class="token punctuation">.</span>extends<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>mixins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> child<span class="token punctuation">.</span>mixins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parent <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> child<span class="token punctuation">.</span>mixins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/*省略...*/</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>​	在<a href="https://lotosv2010.github.io/view/vue/2018/10150800.html#_3-1-%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8" target="_blank" rel="noopener noreferrer">上一章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中我们分析过了参数 <code>parent</code> 和 <code>child</code> 的值在我们当前案例中，这两个参数分别为，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// parent</span>
parent <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		KeepAlive
		Transition<span class="token punctuation">,</span>
    	TransitionGroup
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">directives</span><span class="token operator">:</span><span class="token punctuation">{</span>
	    model<span class="token punctuation">,</span>
        show
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">filters</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token literal-property property">_base</span><span class="token operator">:</span> Vue
<span class="token punctuation">}</span>

<span class="token comment">// child</span>
child <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;&lt;div&gt; {{ name }} &lt;/div&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;robin&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>​	知道了<code>parent</code> 和 <code>child</code> 的参数格式，我们继续看看 <code>mergeOptions</code> 函数中的这段代码，这段代码的作用是处理 <code>extends</code> 选项和 <code>mixins</code> 选项。首先判断我们传进来的 <code>options</code>即 <code>child</code> 是否存在 <code>_base</code> 属性，如果不存在继续执行后面的语句， 然后判断 <code>child.extends</code> 是否存在，如果存在的话就递归调用 <code>mergeOptions</code> 函数将 <code>parent</code> 与 <code>child.extends</code> 进行合并，并将结果作为新的 <code>parent</code>。</p> <p>​	接着检测 <code>child.mixins</code> 选项是否存在，如果存在则使用同样的方式进行操作，不同的是，由于 <code>mixins</code> 是一个数组所以要遍历一下。</p> <div class="custom-block danger"><p class="title"></p><p>说明：由于处理 <code>extends</code> 和 <code>mixins</code>是通过递归调用<code>mergeOptions</code>函数，所有我们在分析完 <code>mergeOptions</code> 以后在来看看这两个处理逻辑。</p></div><p>​	我们继续往下看，代码如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> key
<span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">mergeField</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">mergeField</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/*省略...*/</span>
<span class="token keyword">return</span> options
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>​	这段代码有两个  <code>for</code> 循环，分别是对 <code>parent</code> 和 <code>child</code> 的处理，我们分别来分析一下：</p> <ul><li>第一个<code>for...in</code> 循环</li></ul> <p>​	这个 <code>for... in</code> 用来遍历 <code>parent</code>，并且将 <code>parent</code> 对象的键作为参数传递给 <code>mergeField</code> 函数。前面我们已经知道 <code>parent</code> 对象包含 <code>components</code>、<code>directives</code>、<code>filters</code> 以及 <code>_base</code> 四个属性。</p> <ul><li>第二个<code>for...in</code> 循环</li></ul> <p>​	这个 <code>for... in</code> 用来遍历 <code>child</code>，并且将 <code>child</code> 对象的键作为参数传递给 <code>mergeField</code> 函数。前面我们已经知道 <code>child</code> 对象包含 <code>el</code>、<code>templates</code>、<code>data</code>  三个属性。</p> <p>​	<code>child</code> 的 <code>for... in</code> 循环中唯一和 <code>parent</code> 区别是，如果 <code>child</code> 对象的键也在 <code>parent</code> 上出现，那么就不要再调用 <code>mergeField</code> 了，因为在上一个 <code>for in</code> 循环中已经调用过了，这就避免了重复调用。</p> <p>​	此处的 <code>hasOwn</code> 作用是用来判断一个属性是否是对象自身的属性(不包括原型上的)。</p> <p>​	接下来我们继续看看 <code>mergeField</code> 的定义，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mergeField</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> strat <span class="token operator">=</span> strats<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">||</span> defaultStrat
  options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">strat</span><span class="token punctuation">(</span>parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> child<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>​	<code>mergeField</code> 逻辑很简单，首先通过传进来的 <code>key</code> 在 <code>strats</code> 对象上获取次 <code>key</code> 对应的值赋值给变量 <code>strat</code>，如果不存在则使用默认的 <code>defaultStrat</code> 赋值给变量 <code>strat</code>。</p> <p>​	接下来通过调用 <code>strat</code> 引用的函数以此 <code>key</code> 在<code>parent</code> 和 <code>child</code> 对应的值、<code>vm</code>实例、<code>key</code> 作为参数处理，将返回的结果赋值给此 <code>key</code> 在 <code>options</code> 对象上对应的属性。</p> <h2 id="_2-合并策略"><a href="#_2-合并策略" class="header-anchor">#</a> 2. 合并策略</h2> <p>​	上一小节我们分析了 <code>mergeOptions</code> ，我们知道合并选项最终是通过各自的合并策略完成的，下面我们就分析一下所有的合并策略。</p> <p>​	我们通过调试工具，查看到的 <code>strats</code> 对象最终的结构，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>strats <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">el</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> child<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*defaultStrat...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">propsData</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> child<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*defaultStrat...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*mergeDataOrFn...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token function-variable function">beforeCreate</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">beforeMount</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span> <span class="token punctuation">,</span>
  <span class="token function-variable function">mounted</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">beforeUpdate</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">updated</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">beforeDestroy</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">destroyed</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">activated</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">deactivated</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">errorCaptured</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">serverPrefetch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeHook</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token function-variable function">components</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeAssets</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">directives</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeAssets</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">filters</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeAssets</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token function-variable function">watch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token function-variable function">props</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">methods</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">inject</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">computed</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token function-variable function">provide</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergeDataOrFn</span><span class="token punctuation">(</span> <span class="token parameter">parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_2-1-选项el-propsdata"><a href="#_2-1-选项el-propsdata" class="header-anchor">#</a> 2.1 选项<code>el &amp; propsData</code></h3> <p>​	首先我们来看一下 <code>el &amp; propsData</code>  的合并策略，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  strats<span class="token punctuation">.</span>el <span class="token operator">=</span> strats<span class="token punctuation">.</span><span class="token function-variable function">propsData</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> child<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">option &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; can only be used during instance </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token string">'creation with the `new` keyword.'</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">defaultStrat</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> child<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>​	在非生产环境下，给 <code>strats</code> 对象上添加 <code>el</code> 和 <code>propsData</code> 属性，值为一个匿名函数。这个匿名函数是用来合并 <code>el</code> 选项和 <code>propsData</code> 选项的。</p> <p>​	我们再来看看匿名函数内部的逻辑，首先判断传递 <code>vm</code> 不存在的话直接报一个警告，如果存在则调用 <code>defaultStrat</code> 进行处理。此处需要注意这个警告的内容，表示在父组件中即使用<code>new Vue</code> 创建的实例中使用 <code>el</code> 或 <code>propsData</code>  选项，是没有什么问题，但是在子组件中也使用了 <code>el</code> 或 <code>propsData</code> 选项，这就会得到如上警告。</p> <p>​	如下声明，就会报出上面的警告：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 子组件</span>
<span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#child'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt; {{ name }} &lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'robin'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 父组件</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>child<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;child/&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'robin'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>​	策略函数中的 <code>vm</code> 来自于 <code>mergeOptions</code> 函数的第三个参数。所以当调用 <code>mergeOptions</code> 函数且不传递第三个参数的时候，那么在策略函数中就拿不到 <code>vm</code> 参数。所以我们可以猜测到一件事，那就是 <code>mergeOptions</code> 函数除了在 <code>_init</code> 方法中被调用之外，还在 <code>Vue.extend</code> 方法中被调用的，此时调用 <code>mergeOptions</code> 函数就没有传递第三个参数，也就是说通过 <code>Vue.extend</code> 创建子类的时候 <code>mergeOptions</code> 会被调用，此时策略函数就拿不到第三个参数。</p> <p>​	在策略函数中通过判断是否存在 <code>vm</code> 就能够得知 <code>mergeOptions</code> 是在实例化时调用(使用 <code>new</code> 操作符走 <code>_init</code> 方法)还是在继承时调用(<code>Vue.extend</code>)，而子组件的实现方式就是通过实例化子类完成的，子类又是通过 <code>Vue.extend</code> 创造出来的，所以我们就能通过对 <code>vm</code> 的判断而得知是否是子组件了。</p> <p>​	所以最终的结论就是：<em>如果策略函数中拿不到 <code>vm</code> 参数，那么处理的就是子组件的选项</em>。</p> <p>​	接下来我们回到策略函数中，来分析 <code>defaultStrat</code>，定义如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">defaultStrat</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">parentVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">childVal</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span>
  <span class="token keyword">return</span> childVal <span class="token operator">===</span> <span class="token keyword">undefined</span>
    <span class="token operator">?</span> parentVal
    <span class="token operator">:</span> childVal
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​	它的逻辑很简单，子选项不是 <code>undefined</code> 那么就是用子选项，否则使用父选项。</p> <p>​	但是大家还要注意一点，<code>strats.el</code> 和 <code>strats.propsData</code> 这两个策略函数是只有在非生产环境才有的，在生产环境下访问这两个函数将会得到 <code>undefined</code>，那这个时候 <code>mergeField</code> 函数的第一句代码就起作用了：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 当一个选项没有对应的策略函数时，使用默认策略</span>
<span class="token keyword">const</span> strat <span class="token operator">=</span> strats<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">||</span> defaultStrat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>​	所以在生产环境将直接使用默认的策略函数 <code>defaultStrat</code> 来处理 <code>el</code> 和 <code>propsData</code> 这两个选项。</p> <h3 id="_2-2-选项-data"><a href="#_2-2-选项-data" class="header-anchor">#</a> 2.2 选项 <code>data</code></h3> <p>​	我们再来看看选项 <code>data</code>的合并策略，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>strats<span class="token punctuation">.</span><span class="token function-variable function">data</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parentVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">childVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>Function <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>childVal <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> childVal <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">'The &quot;data&quot; option should be a function '</span> <span class="token operator">+</span>
        <span class="token string">'that returns a per-instance value in component '</span> <span class="token operator">+</span>
        <span class="token string">'definitions.'</span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span>

      <span class="token keyword">return</span> parentVal
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">mergeDataOrFn</span><span class="token punctuation">(</span>parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">mergeDataOrFn</span><span class="token punctuation">(</span>parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>​	这段代码首先在 <code>strats</code> 对象上添加一个 <code>data</code> 属性，其值是一个函数。接下来我们看看，这个函数的内容，函数内部与 <code>el</code> 和 <code>propsData</code> 这两个策略函数相同，先判断是否传递了 <code>vm</code> 这个参数，我们知道当没有 <code>vm</code> 参数时，说明处理的是子组件的选项，那我们就看看对于子组件的选项它是如何处理的。</p> <p>​	首先判断是否传递了子组件的 <code>data</code> 选项(即：<code>childVal</code>)，并且检测 <code>childVal</code> 的类型是不是 <code>function</code>，如果 <code>childVal</code> 的类型不是 <code>function</code> 则会给你一个警告，也就是说 <code>childVal</code> 应该是一个函数，如果不是函数会提示你 <code>data</code> 的类型必须是一个函数，这就是我们知道的：<em>子组件中的 <code>data</code> 必须是一个返回对象的函数</em>。如果不是函数，除了给你一段警告之外，会直接返回 <code>parentVal</code>。</p> <p>​	如果 <code>childVal</code> 是函数类型，那说明满足了子组件的 <code>data</code> 选项需要是一个函数的要求，那么就直接返回 <code>mergeDataOrFn</code> 函数的执行结果。</p> <p>​	接下来如果 <code>vm</code> 存在说明处理的是使用 <code>new</code> 操作符创建实例时的选项，这个时候则直接返回 <code>mergeDataOrFn</code> 的函数执行结果。</p> <p>​	我们注意到了在选项 <code>data</code> 处理策略中，不管是子组件还是使用 <code>new</code> 操作符创建实例的选项,最终都是调用 <code>mergeDataOrFn</code> 函数，不同的是在处理使用 <code>new</code> 操作符创建实例的选项时，多传递了第三个参数 <code>vm</code>。那么问题来了为什么处理使用 <code>new</code> 操作符创建实例的选项要传递 <code>vm</code>？</p> <p>​	接下我们带着这个问题再来分析 <code>mergeDataOrFn</code> 的源码，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mergeDataOrFn</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parentVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">childVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>Function <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// in a Vue.extend merge, both should be functions</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>childVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> parentVal
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parentVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> childVal
    <span class="token punctuation">}</span>
    <span class="token comment">// when parentVal &amp; childVal are both present,</span>
    <span class="token comment">// we need to return a function that returns the</span>
    <span class="token comment">// merged result of both functions... no need to</span>
    <span class="token comment">// check if parentVal is a function here because</span>
    <span class="token comment">// it has to be a function to pass previous merges.</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">mergedDataFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">mergeData</span><span class="token punctuation">(</span>
        <span class="token keyword">typeof</span> childVal <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function">childVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> childVal<span class="token punctuation">,</span>
        <span class="token keyword">typeof</span> parentVal <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function">parentVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> parentVal
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">mergedInstanceDataFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// instance merge</span>
      <span class="token keyword">const</span> instanceData <span class="token operator">=</span> <span class="token keyword">typeof</span> childVal <span class="token operator">===</span> <span class="token string">'function'</span>
        <span class="token operator">?</span> <span class="token function">childVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
        <span class="token operator">:</span> childVal
      <span class="token keyword">const</span> defaultData <span class="token operator">=</span> <span class="token keyword">typeof</span> parentVal <span class="token operator">===</span> <span class="token string">'function'</span>
        <span class="token operator">?</span> <span class="token function">parentVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
        <span class="token operator">:</span> parentVal
      <span class="token keyword">if</span> <span class="token punctuation">(</span>instanceData<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token keyword">return</span> <span class="token function">mergeData</span><span class="token punctuation">(</span>instanceData<span class="token punctuation">,</span> defaultData<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> defaultData
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>​	我们在前面的分析知道，当 <code>vm</code> 存在时说明处理的是非子组件，当 <code>vm</code> 不存时处理的是子组件，在处理子组件和非子组件时都调用了 <code>mergeDataOrFn</code> 函数，只是传递的参数不同，所以我们分析到这里知道前面我们提出的问题的答案了。<code>mergeDataOrFn</code> 中通过 <code>vm</code> 存在与否来判断处理的非子组件还是子组件。</p> <p>​	<code>vm</code> 不存在说明处理的是子组件，执行 <code>if</code> 逻辑，<code>vm</code> 存在说明处理的是非子组件，执行 <code>else</code> 逻辑。</p> <p>​	我们继续往下看，在处理子组件的逻辑中，第一个 <code>if</code> 语句块，如果没有 <code>childVal</code>，也就是说子组件的选项中没有 <code>data</code> 选项，那么直接返回 <code>parentVal</code>，比如下面的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​	我们使用 <code>Vue.extend</code> 函数创建子类的时候传递的子组件选项是一个空对象，即没有 <code>data</code> 选项，那么此时 <code>parentVal</code> 实际上就是 <code>Vue.options</code>，由于 <code>Vue.options</code> 上也没有 <code>data</code> 这个属性，所以压根就不会执行 <code>strats.data</code> 策略函数，也就更不会执行 <code>mergeDataOrFn</code> 函数，有的同学可能会问：既然都没有执行，那么这里的 <code>return parentVal</code> 是不是多余的？当然不多余，因为 <code>parentVal</code> 存在有值的情况。那么什么时候才会出现 <code>childVal</code> 不存在但是 <code>parentVal</code> 存在的情况呢？看下面的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Parent <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> Child <span class="token operator">=</span> Parent<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​	上面的代码中 <code>Parent</code> 类继承了 <code>Vue</code>，而 <code>Child</code> 又继承了 <code>Parent</code>，关键就在于我们使用 <code>Parent.extend</code> 创建 <code>Child</code> 子类的时候，对于 <code>Child</code> 类来讲，<code>childVal</code> 不存在，因为我们没有传递 <code>data</code> 选项，但是 <code>parentVal</code> 存在，即 <code>Parent.options</code> 下的 <code>data</code> 选项，那么 <code>Parent.options</code> 是哪里来的呢？实际就是 <code>Vue.extend</code> 函数内使用 <code>mergeOptions</code> 生成的，所以此时 <code>parentVal</code> 必定是个函数，因为 <code>strats.data</code> 策略函数在处理 <code>data</code> 选项后返回的始终是一个函数。</p> <p>​	由于 <code>childVal</code> 和 <code>parentVal</code> 必定会有其一，否则便不会执行 <code>strats.data</code> 策略函数，所以上面判断的意思就是：<em>如果没有子选项则使用父选项，没有父选项就直接使用子选项，且这两个选项都能保证是函数</em>，如果父子选项同时存在，则代码继续进行。</p> <p>​	接下当父子选项同时存在，那么就返回一个函数 <code>mergedDataFn</code>，注意：此时代码运行就结束了，因为函数已经返回了(<code>return</code>)，至于 <code>mergedDataFn</code> 函数里面又返回了 <code>mergeData</code> 函数的执行结果这句代码目前还没有执行。</p> <p>​	以上就是 <code>strats.data</code> 策略函数在处理子组件的 <code>data</code> 选项时所做的事，我们可以发现 <code>mergeDataOrFn</code> 函数在处理子组件选项时返回的总是一个函数，这也就间接导致 <code>strats.data</code> 策略函数在处理子组件选项时返回的也总是一个函数。</p> <p>​	说完了处理子组件选项的情况，我们再看看处理非子组件选项的情况，也就是使用 <code>new</code> 操作符创建实例时的情况，执行的是 <code>else</code> 分支，它也返回的是一个函数 <code>mergedInstanceDataFn</code> ，注意此时的 <code>mergedInstanceDataFn</code> 函数同样还没有执行，它是 <code>mergeDataOrFn</code> 函数的返回值，所以这再次说明了一个问题：<em><code>mergeDataOrFn</code> 函数永远返回一个函数</em>。</p> <p>​	通过上面的分析我们可以知道 <code>data</code> 选项最终被 <code>mergeOptions</code> 函数处理成了一个函数，当合并处理的是子组件的选项时 <code>data</code> 函数可能是以下三者之一：</p> <ul><li>1、就是 <code>data</code> 本身，因为子组件的 <code>data</code> 选项本身就是一个函数，即如下 <code>mergeDataOrFn</code> 函数的代码段所示：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mergeDataOrFn</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parentVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">childVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>Function <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token comment">// 返回子组件的 data 选项本身</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parentVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> childVal
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>2、父类的 <code>data</code> 选项，如下代码段所示：：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mergeDataOrFn</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parentVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">childVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>Function <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token comment">// 返回父类的 data 选项</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>childVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> parentVal
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>3、<code>mergedDataFn</code> 函数，如下代码段所示：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mergeDataOrFn</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parentVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">childVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>Function <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token comment">// 返回 mergedDataFn 函数</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">mergedDataFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">mergeData</span><span class="token punctuation">(</span>
        <span class="token keyword">typeof</span> childVal <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function">childVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> childVal<span class="token punctuation">,</span>
        <span class="token keyword">typeof</span> parentVal <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function">parentVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> parentVal
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>​	当合并处理的是非子组件的选项时 <code>data</code> 函数为 <code>mergedInstanceDataFn</code> 函数，如下代码段所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mergeDataOrFn</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parentVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">childVal</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>Function <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当合并处理的是非子组件的选项时 `data` 函数为 `mergedInstanceDataFn` 函数</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">mergedInstanceDataFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// instance merge</span>
      <span class="token keyword">const</span> instanceData <span class="token operator">=</span> <span class="token keyword">typeof</span> childVal <span class="token operator">===</span> <span class="token string">'function'</span>
        <span class="token operator">?</span> <span class="token function">childVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
        <span class="token operator">:</span> childVal
      <span class="token keyword">const</span> defaultData <span class="token operator">=</span> <span class="token keyword">typeof</span> parentVal <span class="token operator">===</span> <span class="token string">'function'</span>
        <span class="token operator">?</span> <span class="token function">parentVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
        <span class="token operator">:</span> parentVal
      <span class="token keyword">if</span> <span class="token punctuation">(</span>instanceData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">mergeData</span><span class="token punctuation">(</span>instanceData<span class="token punctuation">,</span> defaultData<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> defaultData
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>​	所以这就是我们一直强调的：<em><code>data</code> 选项最终被处理为一个函数</em>。但是根据我们之前的分析可知，函数分几种情况，但它们都有一个共同的特点，即：<em>这些函数的执行结果就是最终的数据</em>。</p> <p>​	我们可以发现 <code>mergedDataFn</code> 和 <code>mergedInstanceDataFn</code> 这两个函数有一个共同的特点，内部都调用了 <code>mergeData</code> 处理数据并返回，我们先看一下 <code>mergedDataFn</code> 函数，其源码如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">mergedDataFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">mergeData</span><span class="token punctuation">(</span>
    <span class="token keyword">typeof</span> childVal <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function">childVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> childVal<span class="token punctuation">,</span>
    <span class="token keyword">typeof</span> parentVal <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function">parentVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> parentVal
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​	这个函数直接返回了 <code>mergeData</code> 函数的执行结果，再看看 <code>mergedInstanceDataFn</code> 函数，其源码如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mergedInstanceDataFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// instance merge</span>
  <span class="token keyword">const</span> instanceData <span class="token operator">=</span> <span class="token keyword">typeof</span> childVal <span class="token operator">===</span> <span class="token string">'function'</span>
  <span class="token operator">?</span> <span class="token function">childVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
  <span class="token operator">:</span> childVal
  <span class="token keyword">const</span> defaultData <span class="token operator">=</span> <span class="token keyword">typeof</span> parentVal <span class="token operator">===</span> <span class="token string">'function'</span>
  <span class="token operator">?</span> <span class="token function">parentVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
  <span class="token operator">:</span> parentVal
  <span class="token keyword">if</span> <span class="token punctuation">(</span>instanceData<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// childVal存在</span>
    <span class="token keyword">return</span> <span class="token function">mergeData</span><span class="token punctuation">(</span>instanceData<span class="token punctuation">,</span> defaultData<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// childVal不存在，返回parentVal</span>
    <span class="token keyword">return</span> defaultData
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>​	我们知道 <code>childVal</code> 要么是子组件的选项，要么是使用 <code>new</code> 操作符创建实例时的选项，无论是哪一种，总之 <code>childVal</code> 要么是函数，要么就是一个纯对象。所以如果是函数的话就通过执行该函数从而获取到一个纯对象，所以类似上面那段代码中判断 <code>childVal</code> 和 <code>parentVal</code> 的类型是否是函数的目的只有一个，获取数据对象(纯对象)。所以 <code>mergedDataFn</code> 和 <code>mergedInstanceDataFn</code> 函数内部调用 <code>mergeData</code> 方法时传递的两个参数就是两个纯对象(当然你可以简单的理解为两个JSON对象)。</p> <p>​	那么接下来我们在看看<code>mergeData</code> 的源码，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mergeData</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">to</span><span class="token operator">:</span> Object<span class="token punctuation">,</span> <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token operator">?</span>Object</span><span class="token punctuation">)</span><span class="token operator">:</span> Object <span class="token punctuation">{</span>
  <span class="token comment">// 没有 from 直接返回 to</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>from<span class="token punctuation">)</span> <span class="token keyword">return</span> to
  <span class="token keyword">let</span> key<span class="token punctuation">,</span> toVal<span class="token punctuation">,</span> fromVal

  <span class="token keyword">const</span> keys <span class="token operator">=</span> hasSymbol
    <span class="token operator">?</span> Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span>
    <span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span>

  <span class="token comment">// 遍历 from 的 key</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token comment">// 获取对象的key</span>
    <span class="token comment">// in case the object is already observed...</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'__ob__'</span><span class="token punctuation">)</span> <span class="token keyword">continue</span>
    toVal <span class="token operator">=</span> to<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment">// 获取key对应的目标对象的值</span>
    fromVal <span class="token operator">=</span> from<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment">// 获取key对应的来源对象的值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果 from 对象中的 key 不在 to 对象中，则使用 set 函数为 to 对象设置 key 及相应的值</span>
      <span class="token function">set</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> key<span class="token punctuation">,</span> fromVal<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token comment">// 如果 from 对象中的 key 也在 to 对象中，且这两个属性的值都是纯对象则递归进行深度合并</span>
      toVal <span class="token operator">!==</span> fromVal <span class="token operator">&amp;&amp;</span>
      <span class="token function">isPlainObject</span><span class="token punctuation">(</span>toVal<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      <span class="token function">isPlainObject</span><span class="token punctuation">(</span>fromVal<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 深层递归</span>
      <span class="token function">mergeData</span><span class="token punctuation">(</span>toVal<span class="token punctuation">,</span> fromVal<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 其他情况什么都不做</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> to
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>​	如果没有 <code>from</code> 则直接返回 <code>to</code>，也就是说如果没有 <code>parentVal</code> 产生的值，就直接使用 <code>childVal</code> 产生的值。</p> <p>​	如果有 <code>parentVal</code> 产生的值，则代码继续向下运行，我们看 <code>mergeData</code> 最后的返回值仍是 <code>to</code> 对象，所以你应该能猜的到 <code>mergeData</code> 函数的作用，可以简单理解为：<em>将 <code>from</code> 对象的属性混合到 <code>to</code> 对象中，也可以说是将 <code>parentVal</code> 对象的属性混合到 <code>childVal</code> 中</em>，最后返回的是处理后的 <code>childVal</code> 对象。</p> <p><code>mergeData</code> 的具体做法就是像上面 <code>mergeData</code> 函数的代码段中所注释的那样，对 <code>from</code> 对象的 <code>key</code> 进行遍历：</p> <ul><li>如果 <code>from</code> 对象中的 <code>key</code> 不在 <code>to</code> 对象中，则使用 <code>set</code> 函数为 <code>to</code> 对象设置 <code>key</code> 及相应的值。</li> <li>如果 <code>from</code> 对象中的 <code>key</code> 在 <code>to</code> 对象中，且这两个属性的值都是纯对象则递归地调用 <code>mergeData</code> 函数进行深度合并。</li> <li>其他情况不做处理。</li></ul> <p>一、为什么最终 <code>strats.data</code> 会被处理成一个函数？</p> <p>​	这是因为，通过函数返回数据对象，保证了每个组件实例都有一个唯一的数据副本，避免了组件间数据互相影响。后面讲到 <code>Vue</code> 的初始化的时候大家会看到，在初始化数据状态的时候，就是通过执行 <code>strats.data</code> 函数来获取数据并对其进行处理的。</p> <p>二、为什么不在合并阶段就把数据合并好，而是要等到初始化的时候再合并数据？</p> <p>​	这个问题是什么意思呢？我们知道在合并阶段 <code>strats.data</code> 将被处理成一个函数，但是这个函数并没有被执行，而是到了后面初始化的阶段才执行的，这个时候才会调用 <code>mergeData</code> 对数据进行合并处理，那这么做的目的是什么呢？</p> <p>​	其实这么做是有原因的，后面讲到 <code>Vue</code> 的初始化的时候，大家就会发现 <code>inject</code> 和 <code>props</code> 这两个选项的初始化是先于 <code>data</code> 选项的，这就保证了我们能够使用 <code>props</code> 初始化 <code>data</code> 中的数据，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 子组件：使用 props 初始化子组件的 childData </span>
<span class="token keyword">const</span> Child <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;span&gt;&lt;/span&gt;'</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">childData</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentData
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'parentData'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里将输出 parent</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>childData<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
    <span class="token comment">// 通过 props 向子组件传递数据</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;child parent-data=&quot;parent&quot; /&gt;'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      Child
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>如上例所示，子组件的数据 <code>childData</code> 的初始值就是 <code>parentData</code> 这个 <code>props</code>。而之所以能够这样做的原因有两个</p> <ul><li>1、由于 <code>props</code> 的初始化先于 <code>data</code> 选项的初始化</li> <li>2、<code>data</code> 选项是在初始化的时候才求值的，你也可以理解为在初始化的时候才使用 <code>mergeData</code> 进行数据合并。</li></ul> <p>三、你可以这么做。</p> <p>​	在上面的例子中，子组件的 <code>data</code> 选项我们是这么写的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">childData</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentData
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​	但你知道吗，你也可以这么写：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">childData</span><span class="token operator">:</span> vm<span class="token punctuation">.</span>parentData
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 或者使用更简单的解构赋值</span>
<span class="token function">data</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> parentData <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">childData</span><span class="token operator">:</span> parentData
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>​	我们可以通过解构赋值的方式，也就是说 <code>data</code> 函数的参数就是当前实例对象。那么这个参数是在哪里传递进来的呢？其实有两个地方，其中一个地方我们前面见过了，如下面这段代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">mergedDataFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">mergeData</span><span class="token punctuation">(</span>
    <span class="token keyword">typeof</span> childVal <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function">childVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> childVal<span class="token punctuation">,</span>
    <span class="token keyword">typeof</span> parentVal <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function">parentVal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">:</span> parentVal
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​	注意这里的 <code>childVal.call(this, this)</code> 和 <code>parentVal.call(this, this)</code>，关键在于 <code>call(this, this)</code>，可以看到，第一个 <code>this</code> 指定了 <code>data</code> 函数的作用域，而第二个 <code>this</code> 就是传递给 <code>data</code> 函数的参数。</p> <p>​	当然了仅仅在这里这么做是不够的，比如 <code>mergedDataFn</code> 前面的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>childVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> parentVal
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parentVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> childVal
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​	在这段代码中，直接将 <code>parentVal</code> 或 <code>childVal</code> 返回了，我们知道这里的 <code>parentVal</code> 和 <code>childVal</code> 就是 <code>data</code> 函数，由于被直接返回，所以并没有指定其运行的作用域，且也没有传递当前实例作为参数，所以我们必然还是在其他地方做这些事情，而这个地方就是我们说的第二个地方，它在哪里呢？当然是初始化的时候，后面我们会讲到的，如果这里大家没有理解也不用担心。</p> <h3 id="_2-3-选项生命周期"><a href="#_2-3-选项生命周期" class="header-anchor">#</a> 2.3 选项生命周期</h3> <p>​	接下来我们再看一下选项生命周期合并策略，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">LIFECYCLE_HOOKS</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">hook</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  strats<span class="token punctuation">[</span>hook<span class="token punctuation">]</span> <span class="token operator">=</span> mergeHook
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​	这段代码是通过遍历 <code>LIFECYCLE_HOOKS</code> 数组，给 <code>strats</code> 策略对象上添加用来合并各个生命周期钩子选项的策略函数，并且这些生命周期钩子选项的策略函数相同：<em>都是 <code>mergeHook</code> 函数</em>。</p> <p>​	<code>LIFECYCLE_HOOKS</code> 是一个常量，定义如下：</p> <p>​	源码目录： <code>src/shared/constants.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">LIFECYCLE_HOOKS</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'beforeCreate'</span><span class="token punctuation">,</span>
  <span class="token string">'created'</span><span class="token punctuation">,</span>
  <span class="token string">'beforeMount'</span><span class="token punctuation">,</span>
  <span class="token string">'mounted'</span><span class="token punctuation">,</span>
  <span class="token string">'beforeUpdate'</span><span class="token punctuation">,</span>
  <span class="token string">'updated'</span><span class="token punctuation">,</span>
  <span class="token string">'beforeDestroy'</span><span class="token punctuation">,</span>
  <span class="token string">'destroyed'</span><span class="token punctuation">,</span>
  <span class="token string">'activated'</span><span class="token punctuation">,</span>
  <span class="token string">'deactivated'</span><span class="token punctuation">,</span>
  <span class="token string">'errorCaptured'</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>​	所以通过上面的遍历就会在 <code>strats</code> 策略对象上添加如上的 11 个属性，值都为<code>mergeHook</code> 函数。</p> <p>​	接下来我们再来看看<code>mergeHook</code> 函数，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mergeHook</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parentVal</span><span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>Function<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">childVal</span><span class="token operator">:</span> <span class="token operator">?</span>Function <span class="token operator">|</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>Function<span class="token operator">&gt;</span></span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>Function<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> childVal
    <span class="token operator">?</span> parentVal
      <span class="token operator">?</span> parentVal<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>childVal<span class="token punctuation">)</span>
      <span class="token operator">:</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>childVal<span class="token punctuation">)</span>
        <span class="token operator">?</span> childVal
        <span class="token operator">:</span> <span class="token punctuation">[</span>childVal<span class="token punctuation">]</span>
    <span class="token operator">:</span> parentVal
  <span class="token keyword">return</span> res
    <span class="token operator">?</span> <span class="token function">dedupeHooks</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token operator">:</span> res
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>​	<code>mergeHook</code> 函数根据函数上方的注释可知最后被合并成了数组。函数体中 <code>res</code> 的结果由三组三元运算所得：</p> <ul><li>如果子选项不存在直接等于父选项的值</li> <li>如果子选项存在，再判断父选项。如果父选项存在, 就把父子选项合并成一个数组</li> <li>如果父选项不存在，判断子选项是不是一个数组，如果不是数组将其作为数组的元素</li></ul> <p>​	最后 <code>res</code> 有值则以它为参数调用 <code>dedupeHooks</code>函数，返回值作为最终结果返回，否则直接返回 <code>res</code> 。其中<code>dedupeHooks</code> 函数目的是为了剔除选项合并数组中的重复值。</p> <p>​	接下来我们在看看 <code>dedupeHooks</code> 的定义，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">dedupeHooks</span> <span class="token punctuation">(</span><span class="token parameter">hooks</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hooks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​	<code>dedupeHooks</code> 函数中通过遍历钩子数组，去掉数组中的重复值。</p> <div class="custom-block danger"><p class="title"></p><p>注意： 生命周期钩子数组按顺序执行，因此先执行父选项中的钩子函数，后执行子选项中的钩子函数。</p></div><p>​	下面我们举几个例子，来加强一下对 <code>mergeHook</code> 的理解，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'created'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​	如果以这段代码为例，那么对于 <code>strats.created</code> 策略函数来讲(注意这里的 <code>strats.created</code> 就是 <code>mergeHooks</code>)，<code>childVal</code> 就是我们例子中的 <code>created</code> 选项，它是一个函数。<code>parentVal</code> 应该是 <code>Vue.options.created</code>，但 <code>Vue.options.created</code> 是不存在的，所以最终经过 <code>strats.created</code> 函数的处理将返回一个数组：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// res</span>
options<span class="token punctuation">.</span>created <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'created'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​	再看下面的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 2</span>
<span class="token keyword">const</span> Parent <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parentVal'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> Child <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'childVal'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>​	其中 <code>Child</code> 是使用 <code>new Parent</code> 生成的，所以对于 <code>Child</code> 来讲，<code>childVal</code> 是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'childVal'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​	而 <code>parentVal</code> 已经不是 <code>Vue.options.created</code> 了，而是 <code>Parent.options.created</code>，那么 <code>Parent.options.created</code> 是什么呢？它其实是通过 <code>Vue.extend</code> 函数内部的 <code>mergeOptions</code> 处理过的，所以它应该是这样的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Parent<span class="token punctuation">.</span>options<span class="token punctuation">.</span>created <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parentVal'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​	所以这个例子最终的结果就是既有 <code>childVal</code>，又有 <code>parentVal</code>，那么根据 <code>mergeHooks</code> 函数的逻辑执行 <code>parentVal.concat(childVal)</code>这句，将 <code>parentVal</code> 和 <code>childVal</code> 合并成一个数组。所以最终结果如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// res</span>
<span class="token punctuation">[</span>
  <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parentVal'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'childVal'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​	另外我们注意第三个三目运算符：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">:</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>childVal<span class="token punctuation">)</span>
  <span class="token operator">?</span> childVal
  <span class="token operator">:</span> <span class="token punctuation">[</span>childVal<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​	它判断了 <code>childVal</code> 是不是数组，这说明什么？说明了生命周期钩子是可以写成数组的，虽然 <code>Vue</code> 的文档里没有：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">created</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'first'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'second'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'third'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_2-4-选项资源"><a href="#_2-4-选项资源" class="header-anchor">#</a> 2.4 选项资源</h3> <p>​	接下来我们再看一下选项资源合并策略，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">ASSET_TYPES</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  strats<span class="token punctuation">[</span>type <span class="token operator">+</span> <span class="token string">'s'</span><span class="token punctuation">]</span> <span class="token operator">=</span> mergeAssets
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​	这段代码是通过遍历 <code>ASSET_TYPES</code> 数组，给 <code>strats</code> 策略对象上添加用来合并各个资源选项的策略函数，并且这些资源选项的策略函数相同：<em>都是 <code>mergeAssets</code> 函数</em>。</p> <p>​	<code>ASSET_TYPES</code> 是一个常量，定义如下：</p> <p>​	源码目录： <code>src/shared/constants.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ASSET_TYPES</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'component'</span><span class="token punctuation">,</span>
  <span class="token string">'directive'</span><span class="token punctuation">,</span>
  <span class="token string">'filter'</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​	所以通过上面的遍历就会在 <code>strats</code> 策略对象上添加如上的 3 个属性 <code>components</code>、<code>directives</code>、<code>filters</code>，值都为<code>mergeAssets</code>  函数。</p> <p>​	接下来我们再来看看<code>mergeAssets</code>  函数，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mergeAssets</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parentVal</span><span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  <span class="token literal-property property">childVal</span><span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component<span class="token punctuation">,</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Object <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parentVal <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>childVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">assertObjectType</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">extend</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> childVal<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>​	这段代码首先以 <code>parentVal</code> 为原型创建对象 <code>res</code>，然后判断是否有 <code>childVal</code>，如果有的话使用 <code>extend</code> 函数将 <code>childVal</code> 上的属性混合到 <code>res</code> 对象上并返回。如果没有 <code>childVal</code> 则直接返回 <code>res</code>。</p> <p>​	接来我们举个例子，来加强一下对 <code>mergeAssets</code> 的理解，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    Child
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​	上面的代码中，我们创建了一个 <code>Vue</code> 实例，并注册了一个子组件 <code>Child</code>，此时 <code>mergeAssets</code> 方法内的 <code>childVal</code> 就是例子中的 <code>components</code> 选项，而 <code>parentVal</code> 就是 <code>Vue.options.components</code>。我们在前面  <a href="https://lotosv2010.github.io/view/vue/2018/10050800.html#_2-7-options" target="_blank" rel="noopener noreferrer"><strong>vue源码分析(五) 静态属性和方法</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 章节分析过了  <code>Vue.options</code> 的结构，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Vue<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		KeepAlive
		Transition<span class="token punctuation">,</span>
    TransitionGroup
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">directives</span><span class="token operator">:</span><span class="token punctuation">{</span>
	    model<span class="token punctuation">,</span>
      show
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">filters</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token literal-property property">_base</span><span class="token operator">:</span> Vue
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>​	所以 <code>mergeAssets</code> 函数的参数列表中的 <code>parentVal</code> 和 <code>childVal</code> 的值分别为，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// parentVal</span>
parentVal <span class="token operator">=</span> <span class="token punctuation">{</span>
  KeepAlive
  Transition<span class="token punctuation">,</span>
  TransitionGroup
<span class="token punctuation">}</span>

<span class="token comment">// childVal</span>
childVal <span class="token operator">=</span> <span class="token punctuation">{</span>
  Child
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>​	所以经过 <code>Object.create(parentVal || null)</code> 之后，在 <code>res</code> 的原型上添加了 <code>KeepAlive</code> 、<code>Transition</code>、<code>TransitionGroup</code> 三个属性，我们可以通过 <code>.</code> 语法或者 <code>[key]</code> 来获取对应的属性值。然后再经过 <code>extend(res, childVal)</code>  之后，<code>res</code> 变量将被添加 <code>Child</code> 属性，最终 <code>res</code> 如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>res <span class="token operator">=</span> <span class="token punctuation">{</span>
  Child<span class="token punctuation">,</span>
  <span class="token comment">// 原型</span>
  <span class="token literal-property property">__proto__</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    KeepAlive<span class="token punctuation">,</span>
    Transition<span class="token punctuation">,</span>
    TransitionGroup
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​	我们再回到 <code>mergeAssets</code> 函数中，看看这句话的作用，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">assertObjectType</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​	这句话的作用是在开发环境，判断<code>childVal</code> 是否是一个纯对象，如果不是则报一个警告，下面我们再来看看，<code>assertObjectType</code> 函数的定义，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">assertObjectType</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> <span class="token operator">?</span>Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Invalid value for option &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;: expected an Object, </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">but got </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">toRawType</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>​	<code>assertObjectType</code> 很简单，就是使用 <code>isPlainObject</code> 进行判断。</p> <h3 id="_2-5-选项-watch"><a href="#_2-5-选项-watch" class="header-anchor">#</a> 2.5 选项 <code>watch</code></h3> <p>​	接下来我们再看一下选项 <code>watch</code> 合并策略，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>strats<span class="token punctuation">.</span><span class="token function-variable function">watch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parentVal</span><span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  <span class="token literal-property property">childVal</span><span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component<span class="token punctuation">,</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>Object <span class="token punctuation">{</span>
  <span class="token comment">// work around Firefox's Object.prototype.watch...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>parentVal <span class="token operator">===</span> nativeWatch<span class="token punctuation">)</span> parentVal <span class="token operator">=</span> <span class="token keyword">undefined</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>childVal <span class="token operator">===</span> nativeWatch<span class="token punctuation">)</span> childVal <span class="token operator">=</span> <span class="token keyword">undefined</span>
  <span class="token comment">/* istanbul ignore if */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>childVal<span class="token punctuation">)</span> <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parentVal <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assertObjectType</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parentVal<span class="token punctuation">)</span> <span class="token keyword">return</span> childVal
  <span class="token keyword">const</span> ret <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">extend</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> parentVal<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> childVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> parent <span class="token operator">=</span> ret<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">const</span> child <span class="token operator">=</span> childVal<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      parent <span class="token operator">=</span> <span class="token punctuation">[</span>parent<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    ret<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> parent
      <span class="token operator">?</span> parent<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
      <span class="token operator">:</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token operator">?</span> child <span class="token operator">:</span> <span class="token punctuation">[</span>child<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ret
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>​	这段代码是在<code>strats</code> 策略对象上添加 <code>watch</code> 属性，其值为一个函数，用来合并选项<code>watch</code> 的策略函数。这个函数内部首先两句代码是，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// work around Firefox's Object.prototype.watch...</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>parentVal <span class="token operator">===</span> nativeWatch<span class="token punctuation">)</span> parentVal <span class="token operator">=</span> <span class="token keyword">undefined</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>childVal <span class="token operator">===</span> nativeWatch<span class="token punctuation">)</span> childVal <span class="token operator">=</span> <span class="token keyword">undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​	在 <code>Firefox</code> 浏览器中 <code>Object.prototype</code> 拥有原生的 <code>watch</code> 函数，所以即便一个普通的对象你没有定义 <code>watch</code> 属性，但是依然可以通过原型链访问到原生的 <code>watch</code> 属性，这就会给 <code>Vue</code> 在处理选项的时候造成迷惑，因为 <code>Vue</code> 也提供了一个叫做 <code>watch</code> 的选项，即使你的组件选项中没有写 <code>watch</code> 选项，但是 <code>Vue</code> 通过原型访问到了原生的 <code>watch</code>。这不是我们想要的，所以上面两句代码的目的是一个变通方案，当发现组件选项是浏览器原生的 <code>watch</code> 时，那说明用户并没有提供 <code>Vue</code> 的 <code>watch</code> 选项，直接重置为 <code>undefined</code>。</p> <p>​	其中在 <code>nativeWatch</code>，我们看一下它的定义，如下：</p> <p>​	源码目录：<code>src/core/util/env.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Firefox has a &quot;watch&quot; function on Object.prototype...</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> nativeWatch <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>watch
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>nativeWatch</code> 表示在 <code>Firefox</code> 中原生提供了 <code>Object.prototype.watch</code> 函数，所以当运行在 <code>Firefox</code> 中时 <code>nativeWatch</code> 为原生提供的函数，在其他浏览器中 <code>nativeWatch</code> 为 <code>undefined</code>。这个变量主要用于 <code>Vue</code> 处理 <code>watch</code> 选项时与其冲突。</p> <p>​	接下来我们回到策略函数，继续往下看，如下：</p> <p>​	源码目录：<code>src/core/util/env.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>childVal<span class="token punctuation">)</span> <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parentVal <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">assertObjectType</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parentVal<span class="token punctuation">)</span> <span class="token keyword">return</span> childVal
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​	首先检测了是否有 <code>childVal</code>，即组件选项是否有 <code>watch</code> 选项，如果没有的话，直接以 <code>parentVal</code> 为原型创建对象并返回(如果有 <code>parentVal</code> 的话)。</p> <p>​	如果组件选项有 <code>watch</code> 接下来在开发环境判断<code>childVal</code> 是否是一个纯对象，如果不是则报一个警告。如果是，继续判断是否有 <code>parentVal</code>，如果没有的话则直接返回 <code>childVal</code>，即直接使用组件选项的 <code>watch</code>。如果存在 <code>parentVal</code>，那么代码继续执行，此时 <code>parentVal</code> 以及 <code>childVal</code> 都将存在，那么就需要做合并处理了，如下：</p> <p>​	源码目录：<code>src/core/util/env.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ret <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token function">extend</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> parentVal<span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> childVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> parent <span class="token operator">=</span> ret<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token keyword">const</span> child <span class="token operator">=</span> childVal<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parent <span class="token operator">=</span> <span class="token punctuation">[</span>parent<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  ret<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> parent
    <span class="token operator">?</span> parent<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
  <span class="token operator">:</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token operator">?</span> child <span class="token operator">:</span> <span class="token punctuation">[</span>child<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> ret
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>​	这段代码首先定一个变量 <code>ret</code> 用来合并 <code>parentVal</code> 和 <code>childVal</code>，接下来使用 <code>extend</code> 函数将 <code>parentVal</code> 的属性混合到 <code>ret</code> 中，然后在通过 <code>for...in</code> 循环遍历 <code>childVal</code> 。</p> <p>​	在循环体中首先分别获取遍历到的 <code>key</code> 在 <code>parentVal</code> 和 <code>childVal</code> 对象上的值分别为 <code>parent</code> 、<code>child</code>，此时由于遍历的是 <code>childVal</code> 所以 <code>parent</code> 的值不一定存在有可能是 <code>undefined</code> 、而<code>child</code> 的值是一定存在的，所以接下来判断 <code>parent</code> 如果存在并且不是数组类型，则把其包装成数组类型赋值给 <code>parent</code> ，接下是两个三元运算，第一个判断<code>parent</code> 如果存在则把 <code>parent</code> 、<code>child</code> 合并成一个数组赋值给 <code>ret</code> 上对应 <code>key</code> 属性的值，如果不存在继续第二个三元运算判断 <code>child</code> 是否为数组，如果是数组则把 <code>child</code> 直接赋值给 <code>ret</code> 上对应 <code>key</code> 属性的值，如果不是则把 <code>child</code> 包装成数组赋值给 <code>ret</code> 上对应 <code>key</code> 属性的值。</p> <p>​	和前面一样接来我们举个例子，来加强一下对选项 <code>data</code> 合并的理解，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建子类</span>
<span class="token keyword">const</span> Sub <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 检测 test 的变化</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'extend: test change'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 使用子类创建实例</span>
<span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 检测 test 的变化</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'instance: test change'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 修改 test 的值</span>
v<span class="token punctuation">.</span>test <span class="token operator">=</span> <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>​	上面的代码中，当我们修改 <code>v.test</code> 的值时，两个观察 <code>test</code> 变化的函数都将被执行。</p> <p>​	我们使用子类 <code>Sub</code> 创建了实例 <code>v</code>，对于实例 <code>v</code> 来讲，其 <code>childVal</code> 就是组件选项的 <code>watch</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'instance: test change'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​	而其 <code>parentVal</code> 就是 <code>Sub.options</code>，实际上就是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'extend: test change'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​	最终这两个 <code>watch</code> 选项将被合并为一个数组：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'extend: test change'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'instance: test change'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>​		可以发现 <code>watch.test</code> 变成了数组，但是 <code>watch.test</code> 并不一定总是数组，只有父选项(<code>parentVal</code>)也存在对该字段的观测时它才是数组，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建实例</span>
<span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 检测 test 的变化</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'instance: test change'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 修改 test 的值</span>
v<span class="token punctuation">.</span>test <span class="token operator">=</span> <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>​	我们直接使用 <code>Vue</code> 创建实例，这个时候对于实例 <code>v</code> 来说，父选项是 <code>Vue.options</code>，由于 <code>Vue.options</code> 并没有 <code>watch</code> 选项，所以逻辑将直接在 <code>strats.watch</code> 函数的这句话中返回：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parentVal<span class="token punctuation">)</span> <span class="token keyword">return</span> childVal
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​	没有 <code>parentVal</code> 即父选项中没有 <code>watch</code> 选项，则直接返回 <code>childVal</code>，也就是直接返回了子选项的 <code>watch</code> 选项，如就是例子中写的对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'instance: test change'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​	所以此时 <code>test</code> 字段就不再是数组了，而就是一个函数。</p> <p>​	所以大家应该知道：<em>被合并处理后的 <code>watch</code> 选项下的每个键值，有可能是一个数组，也有可能是一个函数</em>。</p> <h3 id="_2-6-选项数据"><a href="#_2-6-选项数据" class="header-anchor">#</a> 2.6 选项数据</h3> <p>​	接下来我们再看一下选项数据合并策略，包括 <code>props</code>、<code>methods</code>、<code>inject</code>、<code>computed</code>，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>strats<span class="token punctuation">.</span>props <span class="token operator">=</span>
strats<span class="token punctuation">.</span>methods <span class="token operator">=</span>
strats<span class="token punctuation">.</span>inject <span class="token operator">=</span>
strats<span class="token punctuation">.</span><span class="token function-variable function">computed</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parentVal</span><span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  <span class="token literal-property property">childVal</span><span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component<span class="token punctuation">,</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>Object <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>childVal <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assertObjectType</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parentVal<span class="token punctuation">)</span> <span class="token keyword">return</span> childVal
  <span class="token keyword">const</span> ret <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token function">extend</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> parentVal<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>childVal<span class="token punctuation">)</span> <span class="token function">extend</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> childVal<span class="token punctuation">)</span>
  <span class="token keyword">return</span> ret
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>​	这段代码的作用是在 <code>strats</code> 策略对象上添加 <code>props</code>、<code>methods</code>、<code>inject</code> 以及 <code>computed</code> 策略函数，这些策略函数是分别用来合并处理同名选项的，并且所使用的策略相同。</p> <p>​	对于 <code>props</code>、<code>methods</code>、<code>inject</code> 以及 <code>computed</code> 这四个选项有一个共同点，就是它们的结构都是纯对象，虽然我们在书写 <code>props</code> 或者 <code>inject</code> 选项的时候可能是一个数组，但是在上一章规范化章节中我们知道，<code>Vue</code> 内部都将其规范化为了一个对象。</p> <p>​	首先，会检测 <code>childVal</code> 是否存在，即子选项是否有相关的属性，如果有的话在非生产环境下需要使用 <code>assertObjectType</code> 检测其类型，保证其类型是纯对象。然后会判断 <code>parentVal</code> 是否存在，不存在的话直接返回子选项。</p> <p>​	如果 <code>parentVal</code> 存在，则使用 <code>extend</code> 方法将其属性混合到新对象 <code>ret</code> 中，如果 <code>childVal</code> 也存在的话，那么同样会再使用 <code>extend</code> 函数将其属性混合到 <code>ret</code> 中，所以如果父子选项中有相同的键，那么子选项会把父选项覆盖掉。</p> <h3 id="_2-7-选项provide"><a href="#_2-7-选项provide" class="header-anchor">#</a> 2.7 选项<code>provide</code></h3> <p>​	接下来我们再看一下选项 <code>provide</code> 合并策略，如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>strats<span class="token punctuation">.</span>provide <span class="token operator">=</span> mergeDataOrFn
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​	<code>provide</code> 选项的合并策略与 <code>data</code> 选项的合并策略相同，都是使用 <code>mergeDataOrFn</code> 函数，这里就不重复讲解了。</p> <h2 id="_3-自定义合并策略"><a href="#_3-自定义合并策略" class="header-anchor">#</a> 3. 自定义合并策略</h2> <p>​	关于 <a href="https://cn.vuejs.org/v2/guide/mixins.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%80%89%E9%A1%B9%E5%90%88%E5%B9%B6%E7%AD%96%E7%95%A5" target="_blank" rel="noopener noreferrer">自定义选项合并策略<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以查看官网的教程。</p> <h2 id="_4-mixins"><a href="#_4-mixins" class="header-anchor">#</a> 4. mixins</h2> <p>​	我们再回到 <code>mergeOptions</code> 看看 <code>mixins</code> 的处理，代码如下：</p> <p>​	源码目录：<code>src/core/util/options.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>mixins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> child<span class="token punctuation">.</span>mixins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parent <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> child<span class="token punctuation">.</span>mixins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​	在分析之前我们先来看一个例子，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> mixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this is mixins created'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>mixin<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this is new Vue created '</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>​	实例化执行会在控制台打印出如下的内容：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'this is mixins created'</span>
<span class="token string">'this is new Vue created'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>​	<code>mergeOptions</code> 函数在处理 <code>mixins</code> 选项的时候递归调用了 <code>mergeOptions</code> 函数将 <code>mixins</code> 合并到了 <code>parent</code> 中，并将合并后生成的新对象作为新的 <code>parent</code> 。</p> <p>​	在我们这个例子中会循环合并 <code>mixins</code> 中的所有选项，当前只有一个 <code>created</code> 生命周期钩子函数，所以最终会调用生命周期的合并策略来处理即调用<code>mergeHook</code>，我们知道生命周期合并策略最终是将相同名称的钩子被合并成了数组，所以所有的生命周期钩子都会被执行。</p> <p>​	除了生命周期，任何写在 <code>mixins</code> 中的选项，都会使用 <code>mergeOptions</code> 中相应的合并策略进行处理，这就是 <code>mixins</code> 的实现方式。</p> <h2 id="_5-extends"><a href="#_5-extends" class="header-anchor">#</a> 5. extends</h2> <p>​	<code>extends</code> 选项，与 <code>mixins</code> 相同，只是由于 <code>extends</code> 选项只能是一个对象，而不能是数组，所以不需要遍历。</p> <h2 id="_6-总结"><a href="#_6-总结" class="header-anchor">#</a> 6. 总结</h2> <p>​	现在我们了解了 <code>Vue</code> 中是如何合并处理选项的，接下来我们做一个总结：</p> <ul><li>对于 <code>el</code>、<code>propsData</code> 选项使用默认的合并策略 <code>defaultStrat</code>。</li> <li>对于 <code>data</code> 选项，使用 <code>mergeDataOrFn</code> 函数进行处理，最终结果是 <code>data</code> 选项将变成一个函数，且该函数的执行结果为真正的数据对象。</li> <li>对于 <code>生命周期钩子</code> 选项，将合并成数组，使得父子选项中的钩子函数都能够被执行</li> <li>对于 <code>directives</code>、<code>filters</code> 以及 <code>components</code> 等资源选项，父子选项将以原型链的形式被处理，正是因为这样我们才能够在任何地方都使用内置组件、指令等。</li> <li>对于 <code>watch</code> 选项的合并处理，类似于生命周期钩子，如果父子选项都有相同的观测字段，将被合并为数组，这样观察者都将被执行。</li> <li>对于 <code>props</code>、<code>methods</code>、<code>inject</code>、<code>computed</code> 选项，父选项始终可用，但是子选项会覆盖同名的父选项字段。</li> <li>对于 <code>provide</code> 选项，其合并策略使用与 <code>data</code> 选项相同的 <code>mergeDataOrFn</code> 函数。</li> <li>最后，以上没有提及到的选项都将使默认选项 <code>defaultStrat</code>。</li> <li>最最后，默认合并策略函数 <code>defaultStrat</code> 的策略是：<em>只要子选项不是 <code>undefined</code> 就使用子选项，否则使用父选项</em>。</li></ul> <p>​	我们这个案例经过选项合并后的 <code>$options</code> 为，如下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>vm<span class="token punctuation">.</span>$options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">directives</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">filters</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;&lt;div&gt; {{ name }} &lt;/div&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">mergedInstanceDataFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">_base</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">Vue</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_1-概述" class="sidebar-link reco-side-_1-概述" data-v-b57cc07c>1. 概述</a></li><li class="level-2" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_2-合并策略" class="sidebar-link reco-side-_2-合并策略" data-v-b57cc07c>2. 合并策略</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_2-1-选项el-propsdata" class="sidebar-link reco-side-_2-1-选项el-propsdata" data-v-b57cc07c>2.1 选项el &amp; propsData</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_2-2-选项-data" class="sidebar-link reco-side-_2-2-选项-data" data-v-b57cc07c>2.2 选项 data</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_2-3-选项生命周期" class="sidebar-link reco-side-_2-3-选项生命周期" data-v-b57cc07c>2.3 选项生命周期</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_2-4-选项资源" class="sidebar-link reco-side-_2-4-选项资源" data-v-b57cc07c>2.4 选项资源</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_2-5-选项-watch" class="sidebar-link reco-side-_2-5-选项-watch" data-v-b57cc07c>2.5 选项 watch</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_2-6-选项数据" class="sidebar-link reco-side-_2-6-选项数据" data-v-b57cc07c>2.6 选项数据</a></li><li class="level-3" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_2-7-选项provide" class="sidebar-link reco-side-_2-7-选项provide" data-v-b57cc07c>2.7 选项provide</a></li><li class="level-2" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_3-自定义合并策略" class="sidebar-link reco-side-_3-自定义合并策略" data-v-b57cc07c>3. 自定义合并策略</a></li><li class="level-2" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_4-mixins" class="sidebar-link reco-side-_4-mixins" data-v-b57cc07c>4. mixins</a></li><li class="level-2" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_5-extends" class="sidebar-link reco-side-_5-extends" data-v-b57cc07c>5. extends</a></li><li class="level-2" data-v-b57cc07c><a href="/view/vue/2018/10160800.html#_6-总结" class="sidebar-link reco-side-_6-总结" data-v-b57cc07c>6. 总结</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.ad2c5d61.js" defer></script><script src="/assets/js/4.82f582a9.js" defer></script><script src="/assets/js/1.72e48573.js" defer></script><script src="/assets/js/57.079ff0b7.js" defer></script>
  </body>
</html>
